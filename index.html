<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Grab Merchant Simulation v41.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root { --grab-green: #00B14F; --grab-yellow: #FFD200; --grab-dark: #004d22; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: #f4f7f6; color: #1a1a1a; min-height: 100vh; margin: 0; overflow-x: hidden; }

        .page { display: none; width: 100%; min-height: 100vh; background: #f4f7f6; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .calc-bg { background: linear-gradient(135deg, #004d22 0%, #00B14F 50%, #008a3d 100%); }
        .glass-panel { background: rgba(255, 255, 255, 0.98); border-radius: 20px; padding: 1.3rem; color: #1a1a1a; border: 1px solid rgba(255, 255, 255, 0.4); box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .sticky-unit { position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; }
        .gradient-header { background: #FFFFFF; padding: 1rem 1.5rem; border-bottom: 4px solid var(--grab-green); }
        .spotlight-dashboard { background: white; border-bottom: 5px solid var(--grab-yellow); }
        .dash-input { background: transparent; border: none; font-weight: 900; width: 100%; text-align: center; outline: none; color: #1a1a1a; font-family: inherit; }

        .animated-border-panel { position: relative; background: #0f172a; border-radius: 24px; padding: 3px; overflow: hidden; }
        .animated-border-panel::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(transparent, transparent, transparent, var(--grab-yellow)); animation: rotate 4s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .vs-inner { position: relative; background: #151f32; border-radius: 21px; padding: 1.2rem; z-index: 1; }
        .vs-card { background: rgba(255,255,255,0.03); border-radius: 18px; padding: 1rem; border: 1px solid rgba(255,255,255,0.08); text-align: center; }
        .vs-card.winner { background: rgba(255, 210, 0, 0.08); border-color: var(--grab-yellow); }
        .vs-amount { font-size: 1.5rem; font-weight: 900; font-style: italic; }

        .chip { flex: 1; padding: 0.6rem 0.2rem; border-radius: 10px; background: #f1f5f9; color: #64748b; font-size: 8px; font-weight: 900; text-transform: uppercase; border: 2px solid transparent; transition: 0.2s; cursor: pointer; text-align: center; line-height: 1.2; }
        .chip.active { background: var(--grab-yellow); color: #1a1a1a; }
        
        .delivery-option { border: 2px solid #e2e8f0; border-radius: 12px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; background: white; cursor: pointer; }
        .delivery-option.selected { border-color: var(--grab-green); background: #f0fff4; }
        .btn-order { background: var(--grab-green); color: white; width: 100%; padding: 1rem; border-radius: 12px; font-weight: 800; font-size: 1.1rem; }
        
        .preset-menu-universal { position: absolute; top: 100%; left: 0; width: 100%; background: white; border: 2px solid #e2e8f0; border-radius: 12px; z-index: 500; display: none; margin-top: 5px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); max-height: 250px; overflow-y: auto; }
        .preset-menu-universal.active { display: block; }

        .toggle-sub { border-radius: 8px; font-size: 9px; font-weight: 900; padding: 4px 8px; cursor: pointer; transition: 0.2s; }
        .toggle-sub-active { background: #ea580c; color: white; }
        .toggle-sub-inactive { background: #fed7aa; color: #9a3412; }
    </style>
</head>
<body onclick="closeAllPopups()">

    <div id="pageCalc" class="page active calc-bg">
        <div class="sticky-unit">
            <header class="gradient-header flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR3eUHGPBllwPFxtkNKY7e_3T_mb2rKNWoMaRD6DON2dMI6swNt9a4Fee2k&s=10" alt="Grab" class="h-8">
                    <p class="font-black text-slate-900 uppercase tracking-tighter">Merchant <span class="text-[var(--grab-green)]">Masterpiece</span></p>
                </div>
                <button onclick="goToPage('pageCheckout')" class="relative p-2 bg-slate-100 rounded-full">
                    <svg class="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" stroke-width="2" stroke-linecap="round"></path></svg>
                    <span id="cartBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>
                </button>
            </header>
            <section class="spotlight-dashboard flex justify-center py-3">
                <div class="max-w-[1000px] w-full grid grid-cols-3 text-center">
                    <div class="border-r border-slate-100 px-1">
                        <p class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">App Price ‚úé</p>
                        <input type="text" id="resApp" class="dash-input text-xl" value="0">
                    </div>
                    <div class="border-r border-slate-100 cursor-pointer group" onclick="showDetail(event, 'cust')">
                        <p class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter group-hover:text-grab-green">Paid by Pax ‚ìò</p>
                        <h2 id="resTP" class="text-xl font-black text-[var(--grab-green)] italic">Rp 0</h2>
                    </div>
                    <div class="cursor-pointer group" onclick="showDetail(event, 'net')">
                        <p class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter group-hover:text-blue-600">Net Rev ‚ìò</p>
                        <h2 id="resNet" class="text-xl font-black text-blue-600 italic">Rp 0</h2>
                    </div>
                </div>
            </section>
        </div>

        <main class="max-w-[1000px] mx-auto p-4 space-y-4 pb-12">
            <div class="glass-panel">
                <label class="font-black text-[11px] uppercase mb-3 block italic text-slate-500">1. Pilih Strategi Campaign</label>
                <div class="grid grid-cols-4 gap-1 p-1 bg-slate-100 rounded-xl">
                    <button onclick="changeScheme('normal', event)" id="chip-normal" class="chip active">‚öñÔ∏è Normal</button>
                    <button onclick="changeScheme('puas-cuan', event)" id="chip-puas-cuan" class="chip">üî• Cuan 32% Hemat / Extra</button>
                    <button onclick="changeScheme('booster', event)" id="chip-booster" class="chip">üöÄ Booster 38% Hemat / Extra</button>
                    <button onclick="changeScheme('cofund', event)" id="chip-cofund" class="chip">ü§ù Cofund</button>
                </div>
            </div>

            <div class="glass-panel">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex flex-col">
                        <span class="text-[9px] font-bold text-[var(--grab-green)] uppercase">Strategic Benefit</span>
                        <h1 id="schemeTitle" class="text-lg font-black uppercase text-slate-800 leading-tight">Normal</h1>
                    </div>
                    <div id="tierSection" class="hidden flex bg-slate-100 p-1 rounded-lg">
                        <button onclick="setTier('hemat')" id="btnHem" class="chip active py-1 px-3">HEMAT</button>
                        <button onclick="setTier('ekstra')" id="btnEks" class="chip py-1 px-3 ml-1">EKSTRA</button>
                    </div>
                </div>
                
                <div id="cofundTierSection" class="hidden border-t pt-3 mb-3">
                    <div class="relative">
                        <button class="w-full bg-slate-50 border-2 border-slate-200 p-3 rounded-xl flex justify-between items-center font-bold text-slate-700 text-[10px] uppercase" onclick="togglePresetMenu(event)">
                            <span id="tierLabelDisplay">PILIH DATABASE PROMO...</span>
                            <span>‚ñº</span>
                        </button>
                        <div id="universalPresetMenu" class="preset-menu-universal"></div>
                    </div>
                </div>
                <div id="benefitDetailContent" class="space-y-3 pt-3 border-t"></div>
            </div>

            <div class="glass-panel">
                <label class="font-black text-[11px] uppercase mb-4 block italic text-slate-500">2. Atur Harga Dasar</label>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <p class="text-[9px] font-bold text-slate-400 mb-1 uppercase">Offline Basis</p>
                        <div class="flex items-center border-2 rounded-xl px-2 h-11 bg-white">
                            <span class="text-xs font-bold text-slate-300">Rp</span>
                            <input type="text" id="mainVal" class="w-full p-2 outline-none font-bold text-slate-800" value="25.000">
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <p class="text-[9px] font-bold text-orange-400 uppercase">Subsidi Toko</p>
                            <div class="flex gap-1">
                                <span onclick="setSubMode('val')" id="modeSubVal" class="toggle-sub toggle-sub-active">Rp</span>
                                <span onclick="setSubMode('pct')" id="modeSubPct" class="toggle-sub toggle-sub-inactive">%</span>
                            </div>
                        </div>
                        <div class="flex items-center border-2 border-orange-100 rounded-xl px-2 h-11 bg-white">
                            <span id="subLabel" class="text-xs font-bold text-orange-300">Rp</span>
                            <input type="text" id="subVal" class="w-full p-2 outline-none font-bold text-orange-800" value="0">
                        </div>
                    </div>
                    
                    <div class="col-span-2">
                        <p class="text-[9px] font-bold text-blue-600 mb-1 uppercase">Input Nama Menu</p>
                        <div class="flex gap-2">
                            <div class="flex-1 flex items-center border-2 border-blue-100 rounded-xl px-2 h-11 bg-white">
                                <input type="text" id="menuName" class="w-full p-2 outline-none font-bold text-blue-800 text-sm" value="Menu Baru">
                            </div>
                            <button onclick="addToCart()" class="bg-emerald-600 text-white px-5 rounded-xl font-black text-xs shadow-lg active:scale-90 transition-all flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-width="3" stroke-linecap="round"></path></svg>
                                TAMBAH
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass-panel">
                <label class="font-black text-[11px] uppercase mb-4 block italic text-slate-500">3. Custom Config</label>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-3">
                        <div><p class="text-[9px] mb-1 font-bold text-slate-400 uppercase">Komisi (%)</p><input type="number" id="kPct" class="w-full p-2 border rounded-lg font-bold text-sm"></div>
                        <div><p class="text-[9px] mb-1 font-bold text-slate-400 uppercase">Diskon (%)</p><input type="number" id="vDisk" class="w-full p-2 border rounded-lg font-bold text-sm"></div>
                    </div>
                    <div class="space-y-3">
                        <div><p class="text-[9px] mb-1 font-bold text-slate-400 uppercase">Min. Order</p><input type="text" id="minO" class="w-full p-2 border rounded-lg font-bold text-sm"></div>
                        <div><p class="text-[9px] mb-1 font-bold text-slate-400 uppercase">Max. Disk</p><input type="text" id="mDisk" class="w-full p-2 border rounded-lg font-bold text-sm"></div>
                    </div>
                    <div id="mexShareContainer" class="col-span-2 hidden pt-2 border-t">
                        <p class="text-[9px] font-bold text-blue-600 mb-1 uppercase">Merchant Share (%)</p>
                        <input type="number" id="mShare" class="w-full p-2 border-blue-200 border rounded-lg font-bold text-sm">
                    </div>
                </div>
            </div>
            
            <div class="animated-border-panel mt-2">
                <div class="vs-inner">
                    <div class="grid grid-cols-2 gap-3 text-center">
                        <div id="cardNormal" class="vs-card">
                            <p class="text-[8px] text-white/30 uppercase font-bold">Polosan</p>
                            <p id="vsPayNormal" class="vs-amount text-white">0</p>
                            <span id="vsAppNormal" class="text-[9px] text-white/50">Rp 0</span>
                        </div>
                        <div id="cardPromo" class="vs-card winner">
                            <p class="text-[8px] text-[var(--grab-yellow)]/0 uppercase font-bold">Harga Ikut Promo</p>
                            <p id="vsPayPromo" class="vs-amount text-[var(--grab-yellow)]">0</p>
                            <span id="vsAppPromo" class="text-[9px] text-[var(--grab-yellow)]/0">Rp 0</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="pageCheckout" class="page bg-white">
        <header class="p-4 flex items-center bg-white sticky top-0 z-50 border-b">
            <button onclick="goToPage('pageCalc')" class="mr-4 text-2xl">‚Üê</button>
            <div>
                <h1 class="font-black text-sm uppercase text-slate-800">Resto Juara</h1>
                <p class="text-[10px] text-slate-400">Simulator Checkout Mode</p>
            </div>
        </header>
        <main class="p-4 pb-44 space-y-6">
            <div class="bg-slate-50 p-3 rounded-2xl border border-slate-100">
                <p class="text-[10px] font-black text-slate-400 mb-2 uppercase tracking-widest text-center">Ganti Skema Campaign (Instan)</p>
                <div class="flex gap-1">
                    <button onclick="switchSimScheme('normal')" id="sim-chip-normal" class="chip active">‚öñÔ∏è Normal</button>
                    <button onclick="switchSimScheme('puas-cuan')" id="sim-chip-puas-cuan" class="chip">üî• Cuan</button>
                    <button onclick="switchSimScheme('booster')" id="sim-chip-booster" class="chip">üöÄ Booster</button>
                </div>
            </div>
            <div class="space-y-2">
                <p class="text-[11px] font-bold text-slate-500 uppercase tracking-wider">Pilihan Pengantaran</p>
                <div onclick="setBaseOngkir(15000, 'prioritas')" id="opt-prioritas" class="delivery-option selected">
                    <div><p class="font-bold text-sm">Prioritas ‚Ä¢ 20 mnt</p></div>
                    <div class="text-right" id="price-prioritas">Rp 15.000</div>
                </div>
                <div onclick="setBaseOngkir(10000, 'standar')" id="opt-standar" class="delivery-option">
                    <p class="font-bold text-sm">Standar ‚Ä¢ 30 mnt</p>
                    <div class="text-right" id="price-standar">Rp 10.000</div>
                </div>
                <div onclick="setBaseOngkir(5000, 'hemat')" id="opt-hemat" class="delivery-option">
                    <p class="font-bold text-sm">Hemat ‚Ä¢ 45 mnt</p>
                    <div class="text-right" id="price-hemat">Rp 5.000</div>
                </div>
            </div>
            <div id="cartItemsList" class="space-y-4 pt-4 border-t"></div>
            <div class="border-t pt-4 space-y-3 text-[13px]">
                <h3 class="font-bold text-sm">Detail pembayaran</h3>
                <div class="flex justify-between text-slate-500"><span>Subtotal</span><span id="sumSubtotal" class="font-bold text-slate-800">Rp 0</span></div>
                <div class="flex justify-between text-slate-500"><span>Ongkos Kirim</span><span id="sumOngkir" class="font-bold text-slate-800">Rp 0</span></div>
                <div class="flex justify-between text-slate-500"><span>Biaya Layanan</span><span class="font-bold text-slate-800">Rp 1.500</span></div>
                <div id="sumPromoRow" class="flex justify-between text-orange-600 font-bold hidden"><span>Diskon Promo Menu</span><span id="sumPromoValue">- Rp 0</span></div>
                <div id="sumOngkirDiscRow" class="flex justify-between text-orange-600 font-bold hidden"><span>Diskon Ongkir</span><span>- Rp 10.000</span></div>
            </div>
        </main>
        <div class="fixed bottom-0 left-0 w-full bg-white p-4 border-t shadow-[0_-10px_20px_rgba(0,0,0,0.05)] z-[100]">
            <div class="flex justify-between items-center mb-4">
                <div><p class="text-xs font-bold">Total Pembayaran</p><p id="savingText" class="text-[10px] text-orange-600 font-bold hidden">Hemat Rp 0! ü•≥</p></div>
                <div class="text-right"><p id="sumTotal" class="text-xl font-black text-slate-900">Rp 0</p></div>
            </div>
            <button class="btn-order shadow-lg">Pesan Sekarang</button>
        </div>
    </div>

    <div id="modal-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[2000] hidden" onclick="closeAllPopups()"></div>
    <div id="detailOverlay" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-[400px] bg-[#1c1c1c] p-6 rounded-[26px] z-[2200] hidden text-white border border-white/10" onclick="closeOverlay()">
        <div id="overlayContent"></div>
        <p class="text-[10px] text-center text-white/20 mt-8 uppercase font-bold tracking-widest">Tap mana saja untuk tutup</p>
    </div>

<script>
    let sTier = 'hemat', currentScheme = 'normal', simScheme = 'normal', subMode = 'val', cart = [], baseOngkir = 15000;
    const state = { mainVal: "25.000", subVal: "0", kPct: 20, vDisk: 0, mDisk: "0", minO: "0", mShare: 0, menuName: "Menu Baru" };
    const calcData = { list: 0, disc: 0, pay: 0, net: 0, mPromo: 0 };

    const STRATEGY_DETAILS = {
        'normal': { k: 20, v: 0, tiers: null, full: [{t: 'Margin Aman 100%', d: 'Kendali penuh profit tanpa potongan kampanye.'}, {t: 'Kestabilan Brand', d: 'Harga menu tetap stabil di mata konsumen.'}] },
        'puas-cuan': { k: 32, v: 30, tiers: { hemat: { min: 15000, max: 45000 }, ekstra: { min: 35000, max: 80000 } }, full: [{t: 'Grab Funded', d: 'Grab danai diskon, merchant bayar marketing fee.'}, {t: 'Volume Efek', d: 'Meningkatkan frekuensi harian secara masif.'}] },
        'booster': { k: 38, v: 35, tiers: { hemat: { min: 15000, max: 55000 }, ekstra: { min: 35000, max: 100000 } }, full: [{t: 'Prioritas Cari', d: 'Urutan teratas hasil pencarian aplikasi.'}, {t: 'Slot Flash Sale', d: 'Akses ke banner utama dengan traffic 3x lebih tinggi.'}] },
        'cofund': { k: 20, v: 40, tiers: null, full: [{t: 'Mega Campaign', d: 'Ikut serta dalam event raksasa Brand Week.'}, {t: 'Sharing Cost', d: 'Kolaborasi bagi biaya diskon untuk user baru.'}] }
    };

    const PRESET_COFUND = [
        { name: "Brand Week Festival", v: 45, s: 55, min: 50000, max: 50000 },
        { name: "Flash Sale Payday", v: 50, s: 60, min: 64000, max: 40000 },
        { name: "Mega Hedon 55%", v: 55, s: 60, min: 40000, max: 35000 }
    ];

    const fNum = (n) => Math.round(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    const pNum = (n) => parseFloat(n.toString().replace(/\./g, "")) || 0;

    function hitung(source = 'offline') {
        const off = pNum(state.mainVal);
        const subRaw = pNum(state.subVal);
        const actualSub = subMode === 'val' ? subRaw : (off * subRaw / 100);
        const k = pNum(state.kPct), v = pNum(state.vDisk), md = pNum(state.mDisk), s = pNum(state.mShare);

        if(source === 'app') {
            const app = pNum(document.getElementById('resApp').value);
            state.mainVal = fNum(Math.round(app * (1 - k/100) + actualSub));
            document.getElementById('mainVal').value = state.mainVal;
        }

        let list = (off - actualSub) / (1 - k/100);
        list = Math.ceil(list/100)*100;
        const disc = Math.min(list * v/100, md || Infinity);
        const pay = list - disc;
        
        calcData.list = list; calcData.pay = pay; calcData.disc = disc;

        if (currentScheme === 'cofund') {
            calcData.mPromo = (s/100) * (v/100) * list;
            calcData.net = list - ((k/100)*(list-calcData.mPromo) + calcData.mPromo);
        } else {
            calcData.net = list * (1 - k/100);
        }

        if(source !== 'app') document.getElementById('resApp').value = fNum(list);
        document.getElementById('resTP').innerText = "Rp " + fNum(pay);
        document.getElementById('resNet').innerText = "Rp " + fNum(calcData.net);
        syncVS(off - actualSub, pay, list);
    }

    function setSubMode(m) {
        subMode = m;
        document.getElementById('modeSubVal').className = m === 'val' ? 'toggle-sub toggle-sub-active' : 'toggle-sub toggle-sub-inactive';
        document.getElementById('modeSubPct').className = m === 'pct' ? 'toggle-sub toggle-sub-active' : 'toggle-sub toggle-sub-inactive';
        document.getElementById('subLabel').innerText = m === 'val' ? 'Rp' : '%';
        hitung();
    }

    function syncVS(cleanOff, pay, list) {
        let ln = Math.ceil((cleanOff / 0.8)/100)*100;
        document.getElementById('vsAppNormal').innerText = "Rp " + fNum(ln);
        document.getElementById('vsPayNormal').innerText = fNum(ln);
        document.getElementById('vsAppPromo').innerText = "Rp " + fNum(list);
        document.getElementById('vsPayPromo').innerText = fNum(pay);
        document.getElementById('cardNormal').className = ln < pay ? 'vs-card winner' : 'vs-card';
        document.getElementById('cardPromo').className = ln >= pay ? 'vs-card winner' : 'vs-card';
    }

    function changeScheme(key, e) {
        if(e) e.stopPropagation();
        currentScheme = key;
        document.querySelectorAll('[id^="chip-"]').forEach(c => c.classList.remove('active'));
        document.getElementById('chip-' + key).classList.add('active');
        const conf = STRATEGY_DETAILS[key];
        document.getElementById('tierSection').classList.toggle('hidden', !conf.tiers);
        document.getElementById('cofundTierSection').classList.toggle('hidden', key !== 'cofund');
        state.kPct = conf.k; state.vDisk = conf.v;
        if(conf.tiers) {
            state.minO = fNum(conf.tiers[sTier].min || 0);
            state.mDisk = fNum(conf.tiers[sTier].max || 0);
        } else {
            state.minO = "0"; state.mDisk = "0"; state.mShare = 0;
        }
        document.getElementById('schemeTitle').innerText = key === 'puas-cuan' ? 'CUAN 32%' : (key === 'booster' ? 'BOOSTER 38%' : key.toUpperCase());
        updateUI(); renderBenefits(); updateTierButtons(); hitung();
    }

    function showDetail(e, type) {
        e.stopPropagation();
        const content = document.getElementById('overlayContent');
        if(type === 'cust') {
            content.innerHTML = `<h3 class="text-emerald-400 font-bold mb-4 uppercase text-xs">Payment Detail</h3><div class="space-y-3"><div class="flex justify-between"><span>Harga Menu (App)</span><span>Rp ${fNum(calcData.list)}</span></div><div class="flex justify-between text-red-400"><span>Diskon Campaign</span><span>- Rp ${fNum(calcData.disc)}</span></div><div class="pt-4 border-t border-white/10 flex justify-between font-black text-xl text-emerald-400 italic"><span>PAID BY PAX</span><span>Rp ${fNum(calcData.pay)}</span></div></div>`;
        } else {
            let totalPotongan = calcData.list - calcData.net;
            let mexInvesmentPct = calcData.list > 0 ? ((totalPotongan / calcData.list) * 100).toFixed(1) : 0;
            let detailFee = currentScheme === 'cofund' ? `<div class="flex justify-between"><span>Merchant Promo Share</span><span>- Rp ${fNum(Math.round(calcData.mPromo))}</span></div>` : `<div class="flex justify-between"><span>Grab Commission (${state.kPct}%)</span><span>- Rp ${fNum(Math.round(calcData.list - calcData.net))}</span></div>`;
            content.innerHTML = `<h3 class="text-blue-400 font-bold mb-4 uppercase text-xs tracking-widest">Revenue Analysis</h3><div class="space-y-3"><div class="flex justify-between font-bold"><span>Harga di App</span><span>Rp ${fNum(calcData.list)}</span></div>${detailFee}<div class="flex justify-between text-blue-300 font-bold bg-blue-500/10 p-2 rounded-lg mt-2"><span>MEX INVESTMENT</span><span>${mexInvesmentPct}%</span></div><div class="pt-4 border-t border-white/10 flex justify-between font-black text-xl text-blue-400 italic"><span>MEX NET REV</span><span>Rp ${fNum(Math.round(calcData.net))}</span></div></div>`;
        }
        document.getElementById('detailOverlay').classList.remove('hidden');
        document.getElementById('modal-overlay').classList.remove('hidden');
    }

    function updateUI() {
        document.getElementById('kPct').value = state.kPct;
        document.getElementById('vDisk').value = state.vDisk;
        document.getElementById('minO').value = state.minO;
        document.getElementById('mDisk').value = state.mDisk;
        document.getElementById('mShare').value = state.mShare;
        document.getElementById('mexShareContainer').classList.toggle('hidden', currentScheme !== 'cofund');
    }

    function addToCart() {
        const name = document.getElementById('menuName').value;
        const offline = pNum(state.mainVal);
        const sub = pNum(state.subVal);
        const m = subMode;
        const existingItem = cart.find(item => item.name === name && item.offline === offline && item.sub === sub && item.subM === m);
        if (existingItem) { existingItem.qty += 1; } else { cart.push({ name, offline, sub, subM: m, qty: 1 }); }
        const b = document.getElementById('cartBadge');
        const totalQty = cart.reduce((acc, item) => acc + item.qty, 0);
        b.innerText = totalQty; b.classList.remove('hidden');
        alert(`"${name}" ditambahkan!`);
    }

    function setBaseOngkir(val, type) { baseOngkir = val; document.querySelectorAll('.delivery-option').forEach(el => el.classList.remove('selected')); document.getElementById('opt-' + type).classList.add('selected'); renderCart(); }

    function renderCart() {
        const listEl = document.getElementById('cartItemsList'); listEl.innerHTML = "";
        let subT = 0, totalPotensialDisc = 0;
        const conf = STRATEGY_DETAILS[simScheme];
        const capMaxDisk = conf.tiers ? conf.tiers[sTier].max : (simScheme === 'cofund' ? pNum(state.mDisk) || Infinity : 0);

        cart.forEach((item, idx) => {
            let actualSub = item.subM === 'val' ? item.sub : (item.offline * item.sub / 100);
            let lp = Math.ceil(((item.offline - actualSub) / (1 - conf.k/100)) / 100) * 100;
            let dpPerUnit = Math.round(lp * (conf.v/100));
            subT += (lp * item.qty);
            totalPotensialDisc += (dpPerUnit * item.qty);
            listEl.innerHTML += `<div class="flex justify-between items-start"><div class="flex gap-3"><div class="w-6 h-6 border-2 border-green-600 text-green-600 rounded flex items-center justify-center font-bold text-xs">${item.qty}</div><div><p class="text-sm font-bold text-slate-800">${item.name}</p><button onclick="removeFromCart(${idx})" class="text-[10px] text-red-500 font-bold uppercase">Hapus</button></div></div><div class="text-right"><p class="text-sm font-bold">Rp ${fNum(lp * item.qty)}</p></div></div>`;
        });

        let finalDiscMenu = Math.min(totalPotensialDisc, capMaxDisk);
        let od = (simScheme === 'puas-cuan' || simScheme === 'booster') ? 10000 : 0;
        let fo = Math.max(0, baseOngkir - od);

        ['prioritas', 'standar', 'hemat'].forEach(t => {
            let b = t === 'prioritas' ? 15000 : (t === 'standar' ? 10000 : 5000); let f = Math.max(0, b - od);
            document.getElementById('price-' + t).innerHTML = od > 0 ? `<span class="text-[10px] text-slate-400 line-through mr-1">Rp ${fNum(b)}</span><span class="text-orange-600 font-bold">Rp ${fNum(f)}</span>` : `<span class="font-bold">Rp ${fNum(b)}</span>`;
        });

        document.getElementById('sumSubtotal').innerText = "Rp " + fNum(subT);
        document.getElementById('sumOngkir').innerText = "Rp " + fNum(fo);
        document.getElementById('sumPromoValue').innerText = "- Rp " + fNum(finalDiscMenu);
        document.getElementById('sumPromoRow').classList.toggle('hidden', finalDiscMenu <= 0);
        document.getElementById('sumOngkirDiscRow').classList.toggle('hidden', od <= 0);
        document.getElementById('sumTotal').innerText = "Rp " + fNum(Math.round((subT - finalDiscMenu) + fo + 1500));
        let saving = Math.round(finalDiscMenu + od);
        document.getElementById('savingText').innerText = `Hemat Rp ${fNum(saving)}! ü•≥`;
        document.getElementById('savingText').classList.toggle('hidden', saving <= 0);
    }

    function switchSimScheme(key) { simScheme = key; document.querySelectorAll('[id^="sim-chip-"]').forEach(c => c.classList.remove('active')); document.getElementById('sim-chip-' + key).classList.add('active'); renderCart(); }
    function renderBenefits() { const d = STRATEGY_DETAILS[currentScheme]; document.getElementById('benefitDetailContent').innerHTML = d.full.map(f => `<div class="flex gap-2.5"><div class="w-4 h-4 bg-emerald-500 rounded-full flex items-center justify-center text-white text-[8px] font-black">‚úì</div><div><p class="font-bold text-[11px] leading-tight">${f.t}</p><p class="text-[10px] text-slate-500">${f.d}</p></div></div>`).join(''); }
    function setTier(t) { sTier = t; changeScheme(currentScheme); }
    function updateTierButtons() { document.getElementById('btnHem').className = sTier === 'hemat' ? 'chip active py-1 px-3' : 'chip py-1 px-3'; document.getElementById('btnEks').className = sTier === 'ekstra' ? 'chip active py-1 px-3' : 'chip py-1 px-3'; }
    function togglePresetMenu(e) { e.stopPropagation(); document.getElementById('universalPresetMenu').classList.toggle('active'); }
    function applyPreset(idx) { const p = PRESET_COFUND[idx]; state.vDisk = p.v; state.mShare = p.s; state.minO = fNum(p.min); state.mDisk = fNum(p.max); document.getElementById('tierLabelDisplay').innerText = p.name; updateUI(); closeAllPopups(); hitung(); }
    function removeFromCart(idx) { if(cart[idx].qty > 1) { cart[idx].qty -= 1; } else { cart.splice(idx, 1); } const totalQty = cart.reduce((acc, item) => acc + item.qty, 0); document.getElementById('cartBadge').innerText = totalQty || ""; if(!cart.length) document.getElementById('cartBadge').classList.add('hidden'); renderCart(); }
    function goToPage(p) { document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active')); document.getElementById(p).classList.add('active'); if(p === 'pageCheckout') switchSimScheme(currentScheme); window.scrollTo(0,0); }
    function closeOverlay() { document.getElementById('detailOverlay').classList.add('hidden'); document.getElementById('modal-overlay').classList.add('hidden'); }
    function closeAllPopups() { if(document.getElementById('universalPresetMenu')) document.getElementById('universalPresetMenu').classList.remove('active'); closeOverlay(); }

    document.getElementById('resApp').addEventListener('input', (e) => { e.target.value = fNum(pNum(e.target.value)); hitung('app'); });
    ['mainVal', 'subVal', 'kPct', 'vDisk', 'mDisk', 'minO', 'mShare'].forEach(id => document.getElementById(id).addEventListener('input', (e) => { 
        if(['mainVal', 'subVal', 'mDisk', 'minO'].includes(id)) e.target.value = fNum(pNum(e.target.value));
        state[id] = e.target.value; hitung(); 
    }));

    window.onload = () => {
        document.getElementById('universalPresetMenu').innerHTML = PRESET_COFUND.map((p, idx) => `<div class="p-3 border-b hover:bg-slate-50 cursor-pointer font-bold text-[10px]" onclick="applyPreset(${idx})">${p.name}</div>`).join('');
        changeScheme('normal');
    };
</script>
</body>
</html>
