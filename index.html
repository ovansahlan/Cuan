<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MerchantCalculator Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --grab-green: #00B14F; 
            --grab-yellow: #FFD200; 
            --grab-dark-green: #004d22;
            --pitch-black: #0F172A;
        }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(135deg, var(--grab-green) 0%, #008a3d 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .elite-card { 
            background: #ffffff; 
            border: 3px solid #000; 
            box-shadow: 8px 8px 0px #000;
            border-radius: 32px;
            width: 100%;
        }

        .dark-elite-card {
            background: var(--pitch-black);
            border: 3px solid #000;
            box-shadow: 8px 8px 0px rgba(0,0,0,0.5);
            border-radius: 32px;
            width: 100%;
        }

        .tab-box { 
            background: rgba(0,0,0,0.2); 
            padding: 4px; 
            border-radius: 24px; 
            position: relative; 
            display: flex; 
            border: 2px solid #000;
        }
        .tab-indicator { 
            position: absolute; 
            height: calc(100% - 8px); 
            width: calc(50% - 4px); 
            background: var(--grab-yellow); 
            border-radius: 18px; 
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
            z-index: 0; 
            border: 2px solid #000;
        }
        .tab-btn { flex: 1; padding: 14px 0; font-size: 11px; font-weight: 800; text-transform: uppercase; z-index: 1; color: white; letter-spacing: 1px; text-align: center; }
        .tab-btn.active { color: black !important; }

        .input-group-elite { 
            background: #f8fafc; 
            border: 2.5px solid #e2e8f0; 
            border-radius: 24px; 
            transition: all 0.2s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .input-group-elite:focus-within { 
            border-color: #000; 
            transform: translateY(-2px);
            box-shadow: 4px 4px 0px #000;
            background: white;
        }

        .label-pitch { font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; color: #1e293b; }
        .value-pitch { font-size: 1.4rem; font-weight: 800; color: #000; }
        
        input:focus { outline: none; }

        .app-highlight-box {
            background: var(--grab-dark-green);
            border: 2.5px solid #000;
            border-radius: 24px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        select { cursor: pointer; text-align-last: center; }
    </style>
</head>
<body id="bodyWrapper">

    <div class="w-full max-w-md p-6 space-y-6">
        <header class="text-center space-y-2">
            <div class="inline-block bg-black text-white text-[9px] font-black px-4 py-1 rounded-full uppercase tracking-[0.3em] mb-1">Official Merchant Tool</div>
            <h1 class="text-4xl font-black text-white tracking-tighter uppercase italic drop-shadow-[3px_3px_0px_rgba(0,0,0,0.3)]">
                Merchant<span class="text-[var(--grab-yellow)]">Calculator</span>
            </h1>
        </header>

        <div class="tab-box">
            <div id="tabSlider" class="tab-indicator"></div>
            <button onclick="switchCategory('full')" id="btnFull" class="tab-btn active">Full Funded</button>
            <button onclick="switchCategory('co')" id="btnCo" class="tab-btn">Co-Funded</button>
        </div>

        <div class="elite-card p-6 space-y-5">
            <div id="priceRow" class="grid grid-cols-2 gap-3 transition-all duration-300">
                <div id="inputBoxMain" class="input-group-elite p-3 text-center">
                    <label id="priceLabel" class="label-pitch block mb-1">Harga Offline</label>
                    <div class="flex items-center justify-center">
                        <span class="text-sm opacity-30 mr-1 font-black italic">Rp</span>
                        <input type="text" id="mainVal" class="bg-transparent w-full value-pitch outline-none text-center" oninput="formatAndCalc(this)">
                    </div>
                </div>
                <div id="appBox" class="app-highlight-box p-3 text-center">
                    <label class="text-[9px] font-black text-green-400 uppercase tracking-widest block mb-1">Harga Jual App</label>
                    <div class="flex items-center justify-center text-white italic">
                        <span class="text-xs mr-1 opacity-50 font-bold">Rp</span>
                        <input type="text" id="resApp" value="0" class="bg-transparent w-full value-pitch outline-none text-center !text-white italic" readonly>
                    </div>
                </div>
            </div>

            <div id="commSection" class="grid grid-cols-2 gap-3">
                <div id="commBox" class="input-group-elite p-3 text-center">
                    <label class="label-pitch block mb-1 italic">Komisi (%)</label>
                    <input type="number" id="kPct" class="bg-transparent w-full value-pitch text-center text-green-600 outline-none" oninput="updateVal('kPct', this.value)">
                </div>
                <div id="roundBox" class="input-group-elite p-3 text-center flex flex-col justify-center border-yellow-200">
                    <label class="label-pitch block mb-1 text-yellow-600">Rounding</label>
                    <select id="roundType" class="bg-transparent w-full font-black text-sm text-center outline-none" onchange="updateVal('roundType', this.value)">
                        <option value="none">Normal</option>
                        <option value="100">Ratusan</option>
                        <option value="1000">Ribuan</option>
                        <option value="up">Ke Atas</option>
                    </select>
                </div>
            </div>

            <div class="p-5 bg-slate-50 rounded-[32px] border-2 border-black space-y-4 shadow-inner">
                <div class="flex justify-between items-center px-1">
                    <label class="label-pitch text-green-600 italic">Campaign Strategy</label>
                    <button onclick="savePreset()" class="px-3 py-1 bg-black text-white text-[8px] font-black rounded-lg active:scale-90 transition-all">ðŸ’¾ SIMPAN</button>
                </div>
                
                <select id="schemaSelect" class="w-full text-sm font-extrabold bg-white border-2 border-black p-3 rounded-2xl outline-none shadow-[3px_3px_0px_#000]" onchange="applySchema(this.value)"></select>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white p-3 rounded-xl border-2 border-slate-200 text-center">
                        <span class="text-[9px] font-black text-slate-400 uppercase block mb-1">Discount (%)</span>
                        <input type="number" id="vDisk" class="w-full text-xl font-black text-green-600 text-center outline-none" oninput="updateVal('vDisk', this.value)">
                    </div>
                    <div class="bg-white p-3 rounded-xl border-2 border-slate-200 text-center">
                        <span class="text-[9px] font-black text-slate-400 uppercase block mb-1">Maks Disc</span>
                        <input type="text" id="mDisk" class="w-full text-xl font-black text-green-600 text-center outline-none" oninput="formatAndCalc(this, 'mDisk')">
                    </div>
                </div>

                <div id="coFundRow" class="hidden pt-2 border-t-2 border-slate-200">
                    <div class="flex justify-between items-center px-2 bg-orange-50 p-3 rounded-xl border-2 border-orange-200">
                        <label class="label-pitch text-orange-600">Merchant Co-Fund (%)</label>
                        <input type="number" id="sBurden" class="w-16 text-center text-xl font-black text-orange-600 bg-white border border-orange-300 rounded-lg outline-none" oninput="updateVal('sBurden', this.value)">
                    </div>
                </div>

                <div class="flex justify-between items-center px-4 py-3 border-[3px] border-black bg-white rounded-2xl shadow-[5px_5px_0px_#00B14F]">
                    <span class="label-pitch text-black">Min. Order</span>
                    <input type="text" id="minO" class="bg-transparent text-right font-black text-xl w-32 outline-none text-green-600" oninput="formatAndCalc(this, 'minO')">
                </div>
            </div>

            <div id="ongkirBox" class="bg-[var(--grab-yellow)] p-2 px-6 rounded-full flex justify-between items-center border-[2.5px] border-black shadow-[4px_4px_0px_#000]">
                <label class="text-[10px] font-black text-black uppercase italic">Ongkir Buyer</label>
                <div class="flex items-center">
                    <span class="text-xs font-bold text-black opacity-30 mr-1 italic">Rp</span>
                    <input type="text" id="vOng" class="bg-transparent text-right font-black text-lg w-20 text-black outline-none" oninput="formatAndCalc(this, 'vOng')">
                </div>
            </div>
        </div>

        <div id="merchantCard" class="dark-elite-card p-7 text-white space-y-5 relative overflow-hidden">
            <div class="text-center space-y-1">
                <p class="text-[10px] font-black text-[var(--grab-yellow)] uppercase tracking-[0.3em] opacity-80">Net Profit Merchant</p>
                <h2 id="resNet" class="text-4xl font-black text-[var(--grab-yellow)] tracking-tighter italic">Rp 0</h2>
            </div>
            
            <div class="pt-4 border-t border-white/10 space-y-3">
                <div class="flex justify-between items-center text-[10px] font-black uppercase text-slate-400 italic">
                    <span>Platform Fee</span>
                    <span id="resKomisi" class="text-white text-sm">-Rp 0</span>
                </div>
                <div id="resBurdRow" class="hidden flex justify-between items-center text-[10px] font-black uppercase text-orange-400 italic">
                    <span>Merchant Contribution</span>
                    <span id="resBurd" class="text-white text-sm">-Rp 0</span>
                </div>
                <div id="investStats" class="hidden pt-3 border-t border-white/5 space-y-2">
                    <div class="flex justify-between items-end">
                        <span class="text-[9px] font-black text-red-500 uppercase tracking-widest">Total Investment</span>
                        <span id="totalInv" class="text-lg font-black text-white italic">Rp 0</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="flex-1 h-2 bg-white/10 rounded-full overflow-hidden">
                            <div id="invBar" class="h-full bg-red-500 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <span id="invPct" class="text-sm font-black text-red-500">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="cardBuyer" class="elite-card p-7 border-b-[12px] border-[var(--grab-yellow)] space-y-4">
            <div class="flex justify-between items-center border-b-2 border-black pb-3">
                <span class="text-[10px] font-black uppercase text-slate-400 italic tracking-[0.1em]">Consumer Overview</span>
                <span id="promoStat" class="text-[9px] font-black bg-black text-white px-4 py-1 rounded-full uppercase italic">Active</span>
            </div>
            <div class="space-y-2">
                <div class="flex justify-between text-xs font-bold text-slate-500 uppercase tracking-tighter italic">
                    <span id="bLabel">Menu Price</span>
                    <span id="bMenu" class="text-black font-black">Rp 0</span>
                </div>
                <div class="flex justify-between text-xs font-bold text-red-600 uppercase tracking-tighter italic">
                    <span>Discount</span>
                    <span id="bDisk" class="font-black">-Rp 0</span>
                </div>
                <div id="bOngRow" class="flex justify-between text-xs font-bold text-slate-500 uppercase tracking-tighter italic">
                    <span>Delivery</span>
                    <span id="bOng" class="text-black font-black">Rp 0</span>
                </div>
                <div class="pt-4 border-t-2 border-dashed border-slate-300 flex justify-between items-center">
                    <span class="text-xs font-black uppercase text-black tracking-widest">Total Payment</span>
                    <span id="bTotal" class="text-3xl font-black text-[var(--grab-green)] tracking-tighter">Rp 0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'full';
        const state = {
            full: { mainVal: "25.000", kPct: 32, vDisk: 30, mDisk: "55.000", minO: "15.000", vOng: "12.000", roundType: "none", schema: "puas-cuan" },
            co: { mainVal: "60.000", kPct: 20, vDisk: 55, mDisk: "50.000", minO: "60.000", vOng: "0", sBurden: 75, schema: "brand-week" }
        };

        const DEFAULT_SCHEMAS = {
            full: { 
                'puas-cuan': { name: 'ðŸ”¥ Diskon Puas Cuan', k: 32, v: 30, m: 55000, min: 15000 },
                'booster-hemat': { name: 'ðŸš€ Booster Hemat', k: 38, v: 35, m: 55000, min: 15000 },
                'booster-ekstra': { name: 'â­ Booster Ekstra', k: 38, v: 35, m: 80000, min: 35000 }
            },
            co: { 
                'brand-week': { name: 'ðŸŽŠ BRAND WEEK FESTIVAL', k: 20, v: 55, m: 50000, min: 60000, burden: 75 },
                'co-standard': { name: 'ðŸ¤ Co-Funded Standard', k: 20, v: 20, m: 50000, min: 10000, burden: 35 } 
            }
        };

        let customPresets = JSON.parse(localStorage.getItem('grab_presets_vSeparated')) || JSON.parse(JSON.stringify(DEFAULT_SCHEMAS));

        const fNum = (n) => n.toString().replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        const pNum = (n) => parseFloat(n.toString().replace(/\./g, "")) || 0;

        function formatAndCalc(el, field = 'mainVal') {
            el.value = fNum(el.value);
            state[currentMode][field] = el.value;
            hitung();
        }

        function updateVal(field, val) {
            state[currentMode][field] = val;
            hitung();
        }

        function switchCategory(mode) {
            currentMode = mode;
            const slider = document.getElementById('tabSlider');
            const btnFull = document.getElementById('btnFull');
            const btnCo = document.getElementById('btnCo');
            const inputBoxMain = document.getElementById('inputBoxMain');

            document.getElementById('mainVal').value = state[mode].mainVal;
            document.getElementById('kPct').value = state[mode].kPct;
            document.getElementById('vDisk').value = state[mode].vDisk;
            document.getElementById('mDisk').value = state[mode].mDisk;
            document.getElementById('minO').value = state[mode].minO;
            document.getElementById('vOng').value = state[mode].vOng;
            document.getElementById('roundType').value = state[mode].roundType;
            if(mode === 'co') document.getElementById('sBurden').value = state[mode].sBurden;

            if(mode === 'full') {
                slider.style.transform = 'translateX(0)';
                btnFull.classList.add('active'); btnCo.classList.remove('active');
                document.getElementById('appBox').classList.remove('hidden');
                document.getElementById('priceRow').classList.add('grid-cols-2');
                inputBoxMain.className = 'input-group-elite p-3 text-center col-span-1';
                document.getElementById('priceLabel').innerText = 'Harga Offline';
                document.getElementById('ongkirBox').classList.remove('hidden');
                document.getElementById('bOngRow').classList.remove('hidden');
                document.getElementById('coFundRow').classList.add('hidden');
                document.getElementById('investStats').classList.add('hidden');
                document.getElementById('commBox').className = 'input-group-elite p-3 text-center col-span-1';
                document.getElementById('roundBox').classList.remove('hidden');
                document.getElementById('bLabel').innerText = 'Menu Price';
            } else {
                slider.style.transform = 'translateX(100%)';
                btnFull.classList.remove('active'); btnCo.classList.add('active');
                document.getElementById('appBox').classList.add('hidden');
                document.getElementById('priceRow').classList.remove('grid-cols-2');
                inputBoxMain.className = 'input-group-elite p-4 text-center border-dashed border-2 border-orange-500 col-span-2 shadow-inner';
                document.getElementById('priceLabel').innerText = 'Avg. Basket Size';
                document.getElementById('ongkirBox').classList.add('hidden');
                document.getElementById('bOngRow').classList.add('hidden');
                document.getElementById('coFundRow').classList.remove('hidden');
                document.getElementById('investStats').classList.remove('hidden');
                document.getElementById('commBox').className = 'input-group-elite p-3 text-center col-span-2';
                document.getElementById('roundBox').classList.add('hidden');
                document.getElementById('bLabel').innerText = 'Value Per Order';
            }
            renderSchemaDropdown();
        }

        function renderSchemaDropdown() {
            const select = document.getElementById('schemaSelect');
            select.innerHTML = '';
            for (let key in customPresets[currentMode]) {
                let opt = document.createElement('option');
                opt.value = key; opt.innerText = customPresets[currentMode][key].name;
                select.appendChild(opt);
            }
            let customOpt = document.createElement('option');
            customOpt.value = 'custom'; customOpt.innerText = '-- MANUAL CONFIG --';
            select.appendChild(customOpt);
            select.value = state[currentMode].schema;
            hitung();
        }

        function applySchema(key) {
            state[currentMode].schema = key;
            if (key !== 'custom') {
                const config = customPresets[currentMode][key];
                state[currentMode].kPct = config.k;
                state[currentMode].vDisk = config.v;
                state[currentMode].mDisk = fNum(config.m);
                state[currentMode].minO = fNum(config.min);
                if(currentMode === 'co') state[currentMode].sBurden = config.burden;

                document.getElementById('kPct').value = state[currentMode].kPct;
                document.getElementById('vDisk').value = state[currentMode].vDisk;
                document.getElementById('mDisk').value = state[currentMode].mDisk;
                document.getElementById('minO').value = state[currentMode].minO;
                if(currentMode === 'co') document.getElementById('sBurden').value = state[currentMode].sBurden;
            }
            hitung();
        }

        function savePreset() {
            const name = prompt("Campaign Name:"); if (!name) return;
            const id = "p_" + Date.now();
            customPresets[currentMode][id] = {
                name: "â­ " + name,
                k: parseFloat(document.getElementById('kPct').value) || 0,
                v: parseFloat(document.getElementById('vDisk').value) || 0,
                m: pNum(state[currentMode].mDisk),
                min: pNum(state[currentMode].minO),
                burden: currentMode === 'co' ? parseFloat(document.getElementById('sBurden').value) : 0
            };
            localStorage.setItem('grab_presets_vSeparated', JSON.stringify(customPresets));
            state[currentMode].schema = id;
            renderSchemaDropdown();
        }

        function hitung() {
            const mainVal = pNum(state[currentMode].mainVal);
            const kPct = (parseFloat(state[currentMode].kPct) || 0) / 100;
            const vOng = pNum(state[currentMode].vOng);
            const vDiskPct = (parseFloat(state[currentMode].vDisk) || 0) / 100;
            const mDisk = pNum(state[currentMode].mDisk);
            const minO = pNum(state[currentMode].minO);
            const sBurdPct = (parseFloat(state[currentMode].sBurden) || 0) / 100;
            const roundType = state[currentMode].roundType;

            let hApp, nomDisk, nett, nomKomisi, nomBurd;

            if (currentMode === 'full') {
                let rawApp = Math.ceil(mainVal / (1 - kPct || 0.01));
                if (roundType === "100") hApp = Math.round(rawApp / 100) * 100;
                else if (roundType === "1000") hApp = Math.round(rawApp / 1000) * 1000;
                else if (roundType === "up") hApp = Math.ceil(rawApp / 1000) * 1000;
                else hApp = rawApp;

                nomDisk = (hApp >= minO) ? Math.min(hApp * vDiskPct, mDisk) : 0;
                nomKomisi = hApp * kPct; nomBurd = 0; nett = hApp - nomKomisi;
                document.getElementById('resApp').value = fNum(hApp);
                document.getElementById('resBurdRow').classList.add('hidden');
            } else {
                hApp = mainVal;
                nomDisk = (hApp >= minO) ? Math.min(hApp * vDiskPct, mDisk) : 0;
                nomBurd = nomDisk * sBurdPct;
                const sisa = hApp - nomBurd;
                nomKomisi = sisa * kPct; nett = sisa - nomKomisi;
                document.getElementById('resBurdRow').classList.remove('hidden');
                const totalInv = nomKomisi + nomBurd;
                const invRatio = (mainVal > 0 ? (totalInv / mainVal) * 100 : 0);
                document.getElementById('totalInv').innerText = "Rp " + fNum(Math.round(totalInv));
                document.getElementById('invPct').innerText = invRatio.toFixed(1) + "%";
                document.getElementById('invBar').style.width = Math.min(invRatio, 100) + "%";
            }

            const fmtRp = (v) => "Rp " + fNum(Math.round(v));
            document.getElementById('resNet').innerText = fmtRp(nett);
            document.getElementById('resKomisi').innerText = "- " + fmtRp(nomKomisi);
            document.getElementById('resBurd').innerText = "- " + fmtRp(nomBurd);
            document.getElementById('bMenu').innerText = fmtRp(hApp);
            document.getElementById('bDisk').innerText = "- " + fmtRp(nomDisk);
            document.getElementById('bOng').innerText = fmtRp(vOng);
            document.getElementById('bTotal').innerText = fmtRp(Math.max(0, (hApp - nomDisk) + (currentMode === 'full' ? vOng : 0)));
            
            const promoStat = document.getElementById('promoStat');
            promoStat.innerText = nomDisk > 0 ? "ACTIVE" : "NOT ACTIVE";
            promoStat.style.background = nomDisk > 0 ? "var(--grab-yellow)" : "#ef4444";
            promoStat.style.color = nomDisk > 0 ? "black" : "white";
        }

        window.onload = () => switchCategory('full');
    </script>
</body>
</html>
