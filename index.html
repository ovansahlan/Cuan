<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grab Simulator Pro - Custom Presets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --grab-green: #00B14F; --grab-yellow: #FFD200; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--grab-green); color: #1A1D1F; transition: background 0.5s ease; }
        
        .grab-card { background: white; border-radius: 28px; box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
        
        /* Tab Slider Animation */
        .tab-container { background: rgba(0,0,0,0.15); border-radius: 16px; position: relative; display: flex; padding: 4px; border: 1px solid rgba(255,255,255,0.1); }
        .tab-slider { position: absolute; height: calc(100% - 8px); width: calc(50% - 4px); background: var(--grab-yellow); border-radius: 12px; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 0; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .tab-btn { flex: 1; padding: 12px 0; font-size: 10px; font-weight: 800; text-transform: uppercase; z-index: 1; transition: color 0.3s; }
        .tab-btn.active { color: black; }
        .tab-btn.inactive { color: rgba(255,255,255,0.7); }

        .input-box { background-color: #f8fafc; border: 2px solid #e2e8f0; transition: all 0.2s; border-radius: 18px; }
        .input-box:focus-within { border-color: var(--grab-green); background-color: white; transform: translateY(-1px); }
        
        input:focus { outline: none; }
        .merchant-card { background: #111827; color: white; border-radius: 28px; border-top: 4px solid var(--grab-yellow); transition: all 0.3s; }
        
        /* Custom Styling */
        .btn-save { background: #f1f5f9; color: #64748b; font-size: 9px; font-weight: 800; padding: 4px 8px; border-radius: 8px; transition: all 0.2s; }
        .btn-save:hover { background: var(--grab-green); color: white; }
    </style>
</head>
<body class="min-h-screen pb-10" id="bodyBg">

    <div class="max-w-md mx-auto p-5 space-y-4">
        <header class="text-center pt-4 pb-2 text-white font-black italic text-3xl tracking-tighter uppercase">
            PROMO <span class="text-[var(--grab-yellow)]">CALCULATOR</span>
        </header>

        <div class="tab-container">
            <div id="slider" class="tab-slider"></div>
            <button onclick="switchCategory('full')" id="btnFull" class="tab-btn active">Full Funded</button>
            <button onclick="switchCategory('co')" id="btnCo" class="tab-btn inactive">Co-Funded</button>
        </div>

        <div class="grab-card p-6 space-y-4">
            <div id="priceSection" class="grid grid-cols-2 gap-3 transition-all duration-300">
                <div class="input-box p-3 text-center border-2">
                    <label id="priceLabel" class="text-[9px] font-black text-gray-400 uppercase block mb-1 tracking-widest">Harga Offline</label>
                    <div class="flex items-center justify-center font-black">
                        <span class="text-xs text-gray-300 mr-1">Rp</span>
                        <input type="text" id="mainInput" value="25.000" class="bg-transparent w-full text-xl outline-none text-center" oninput="formatAndCalc(this)">
                    </div>
                </div>
                <div id="appPriceBox" class="bg-green-50 p-3 rounded-2xl text-center border-2 border-green-100">
                    <label class="text-[9px] font-black text-green-600 uppercase block mb-1 tracking-widest">Harga di App</label>
                    <div class="flex items-center justify-center font-black text-green-700">
                        <span class="text-xs mr-1">Rp</span>
                        <input type="text" id="resAppInput" class="bg-transparent w-full text-xl outline-none text-center" readonly>
                    </div>
                </div>
            </div>

            <div class="input-box p-3 flex justify-between items-center px-5">
                <label class="text-[10px] font-black text-gray-500 uppercase italic">Komisi (%)</label>
                <input type="number" id="kPct" value="32" class="bg-transparent text-right font-black text-lg w-16 outline-none text-green-600" oninput="hitung()">
            </div>

            <div class="space-y-3 p-4 bg-gray-50 rounded-2xl border border-gray-100 relative">
                <div class="flex justify-between items-center">
                    <label class="text-[10px] font-black text-green-600 uppercase italic">Skema Diskon</label>
                    <button onclick="savePreset()" class="btn-save uppercase">ðŸ’¾ Simpan Preset</button>
                </div>
                
                <select id="schemaSelect" class="w-full text-[10px] font-black bg-white border border-gray-200 p-2 rounded-xl outline-none shadow-sm" onchange="applySchema()"></select>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white p-2 px-3 rounded-xl border border-gray-200">
                        <span class="text-[8px] font-bold text-gray-400 uppercase block italic">Diskon (%)</span>
                        <input type="number" id="vDisk" value="30" class="w-full font-black text-green-600 outline-none" oninput="hitung()">
                    </div>
                    <div class="bg-white p-2 px-3 rounded-xl border border-gray-200">
                        <span class="text-[8px] font-bold text-gray-400 uppercase block italic">Maks Rp</span>
                        <input type="text" id="mDisk" value="55.000" class="w-full font-black text-green-600 outline-none" oninput="formatAndCalc(this)">
                    </div>
                </div>
                
                <div id="coFundControl" class="hidden pt-3 border-t border-gray-200 flex justify-between items-center px-2">
                    <label class="text-[10px] font-black text-orange-600 uppercase italic">Co-Fund Seller (%)</label>
                    <div class="flex items-center gap-1 bg-white border border-orange-200 rounded-lg px-2 py-1">
                        <input type="number" id="sBurdenInput" value="35" class="w-10 text-center font-black text-orange-600 outline-none" oninput="hitung()">
                        <span class="text-[10px] font-bold text-orange-400">%</span>
                    </div>
                </div>
                <div class="flex justify-between items-center px-2 text-[9px] font-bold text-gray-400 uppercase">
                    <span>Min. Order Skema:</span>
                    <input type="text" id="minOInput" value="15.000" class="bg-transparent text-right font-black text-gray-700 w-16 outline-none" oninput="formatAndCalc(this)">
                </div>
            </div>

            <div id="ongkirBox" class="input-box p-3 flex justify-between items-center px-5 border-blue-100">
                <label class="text-[10px] font-black text-blue-500 uppercase tracking-widest italic">Ongkir Buyer</label>
                <div class="flex items-center">
                    <span class="text-xs font-bold text-blue-300 mr-1">Rp</span>
                    <input type="text" id="vOng" value="12.000" class="bg-transparent text-right font-black text-lg w-24 text-blue-600 outline-none" oninput="formatAndCalc(this)">
                </div>
            </div>
        </div>

        <div id="merchantCard" class="merchant-card p-7 shadow-2xl space-y-4">
            <div>
                <p class="text-[10px] font-black text-[var(--grab-yellow)] uppercase tracking-[0.2em]">Hasil Akhir Merchant</p>
                <h2 id="resNet" class="text-4xl font-black text-[var(--grab-yellow)] tracking-tighter italic mt-1">Rp 0</h2>
            </div>
            <div class="pt-4 border-t border-white/10 space-y-3">
                <div class="flex justify-between text-[10px] font-bold uppercase italic opacity-70">
                    <span>Komisi Grab</span>
                    <span id="resKomisi">-Rp 0</span>
                </div>
                <div id="rowBurd" class="hidden flex justify-between text-[10px] font-bold text-orange-400 uppercase italic">
                    <span>Beban Co-Fund Promo</span>
                    <span id="resBurd">-Rp 0</span>
                </div>
                <div id="investStats" class="hidden pt-2 border-t border-white/5 space-y-2">
                    <div class="flex justify-between text-[11px] font-black text-red-400 uppercase tracking-tighter">
                        <span>Investasi Merchant</span>
                        <span id="totalInv">Rp 0</span>
                    </div>
                    <div class="flex justify-between text-[11px] font-black text-red-400 uppercase">
                        <span>Biaya Promo (%)</span>
                        <span id="invPct">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="cardBuyer" class="grab-card p-6 border-b-8 border-[var(--grab-yellow)]">
            <div class="space-y-3">
                <div class="flex justify-between items-center border-b border-gray-100 pb-2">
                    <span class="text-[10px] font-black uppercase text-gray-400 italic">Rincian Pembeli</span>
                    <span id="promoStat" class="text-[9px] font-black bg-[var(--grab-yellow)] px-2 py-0.5 rounded uppercase">Aktif</span>
                </div>
                <div class="space-y-1.5 text-xs font-bold text-gray-600 uppercase text-[9px]">
                    <div class="flex justify-between font-black">
                        <span id="buyerPriceLabel">Harga di App</span>
                        <span id="bMenu">Rp 0</span>
                    </div>
                    <div class="flex justify-between text-red-500 italic font-black">
                        <span>Potongan Diskon</span>
                        <span id="bDisk">-Rp 0</span>
                    </div>
                    <div id="rowBuyerOng" class="flex justify-between border-b border-gray-50 pb-2">
                        <span>Ongkos Kirim</span>
                        <span id="bOng">Rp 0</span>
                    </div>
                </div>
                <div class="pt-2 flex justify-between items-center">
                    <span class="text-xs font-black uppercase text-gray-800 leading-none">Total<br>Checkout</span>
                    <span id="bTotal" class="text-4xl font-black text-[var(--grab-green)] tracking-tighter">Rp 0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'full';
        let customPresets = JSON.parse(localStorage.getItem('grab_presets')) || {
            full: { 
                'puas-cuan': { name: 'ðŸ”¥ Diskon Puas Cuan', k: 32, v: 30, m: 55000, min: 15000 },
                'booster-hemat': { name: 'ðŸš€ Booster Hemat', k: 38, v: 35, m: 55000, min: 15000 },
                'booster-ekstra': { name: 'â­ Booster Ekstra', k: 38, v: 35, m: 80000, min: 35000 }
            },
            co: { 
                'co-standard': { name: 'ðŸ¤ Co-Funded Standard', k: 20, v: 20, m: 50000, min: 10000, burden: 35 } 
            }
        };

        function formatNumber(n) {
            return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function parseNumber(n) {
            return parseFloat(n.toString().replace(/\./g, "")) || 0;
        }

        function formatAndCalc(el) {
            el.value = formatNumber(el.value);
            hitung();
        }

        function switchCategory(mode) {
            currentMode = mode;
            const slider = document.getElementById('slider');
            const btnFull = document.getElementById('btnFull');
            const btnCo = document.getElementById('btnCo');
            const body = document.getElementById('bodyBg');

            if(mode === 'full') {
                slider.style.transform = 'translateX(0)';
                btnFull.className = 'tab-btn active';
                btnCo.className = 'tab-btn inactive';
                body.style.background = '#00B14F';
                
                document.getElementById('appPriceBox').style.display = 'block';
                document.getElementById('priceSection').classList.add('grid-cols-2');
                document.getElementById('priceLabel').innerText = 'Harga Offline';
                document.getElementById('ongkirBox').style.display = 'flex';
                document.getElementById('coFundControl').classList.add('hidden');
                document.getElementById('investStats').classList.add('hidden');
            } else {
                slider.style.transform = 'translateX(100%)';
                btnFull.className = 'tab-btn inactive';
                btnCo.className = 'tab-btn active';
                body.style.background = '#008a3d';
                
                document.getElementById('appPriceBox').style.display = 'none';
                document.getElementById('priceSection').classList.remove('grid-cols-2');
                document.getElementById('priceLabel').innerText = 'Total Order (Basket Size)';
                document.getElementById('ongkirBox').style.display = 'none';
                document.getElementById('coFundControl').classList.remove('hidden');
                document.getElementById('investStats').classList.remove('hidden');
            }
            renderSchemaDropdown();
            applySchema();
        }

        function renderSchemaDropdown() {
            const select = document.getElementById('schemaSelect');
            select.innerHTML = '';
            for (let key in customPresets[currentMode]) {
                let opt = document.createElement('option');
                opt.value = key; opt.innerText = customPresets[currentMode][key].name;
                select.appendChild(opt);
            }
            let customOpt = document.createElement('option');
            customOpt.value = 'custom'; customOpt.innerText = 'âš™ï¸ INPUT MANUAL';
            select.appendChild(customOpt);
        }

        function applySchema() {
            const key = document.getElementById('schemaSelect').value;
            if (key !== 'custom') {
                const config = customPresets[currentMode][key];
                document.getElementById('kPct').value = config.k;
                document.getElementById('vDisk').value = config.v;
                document.getElementById('mDisk').value = formatNumber(config.m.toString());
                document.getElementById('minOInput').value = formatNumber(config.min.toString());
                if(currentMode === 'co') document.getElementById('sBurdenInput').value = config.burden;
            }
            hitung();
        }

        function savePreset() {
            const name = prompt("Masukkan Nama Preset:");
            if (!name) return;
            const id = "custom_" + Date.now();
            const config = {
                name: "â­ " + name,
                k: parseFloat(document.getElementById('kPct').value),
                v: parseFloat(document.getElementById('vDisk').value),
                m: parseNumber(document.getElementById('mDisk').value),
                min: parseNumber(document.getElementById('minOInput').value),
                burden: currentMode === 'co' ? parseFloat(document.getElementById('sBurdenInput').value) : 0
            };
            customPresets[currentMode][id] = config;
            localStorage.setItem('grab_presets', JSON.stringify(customPresets));
            renderSchemaDropdown();
            document.getElementById('schemaSelect').value = id;
            alert("Preset berhasil disimpan!");
        }

        function hitung() {
            const mainVal = parseNumber(document.getElementById('mainInput').value);
            const kPct = (parseFloat(document.getElementById('kPct').value) || 0) / 100;
            const vOng = parseNumber(document.getElementById('vOng').value);
            const vDiskPct = (parseFloat(document.getElementById('vDisk').value) || 0) / 100;
            const mDisk = parseNumber(document.getElementById('mDisk').value);
            const sBurdPct = (parseFloat(document.getElementById('sBurdenInput').value) || 0) / 100;
            const minO = parseNumber(document.getElementById('minOInput').value);

            let hApp, nomDisk, nett, nomKomisi, nomBurd;

            if (currentMode === 'full') {
                hApp = Math.ceil(mainVal / (1 - kPct || 0.01));
                nomDisk = (hApp >= minO) ? Math.min(hApp * vDiskPct, mDisk) : 0;
                nomKomisi = hApp * kPct;
                nomBurd = 0;
                nett = hApp - nomKomisi;
                document.getElementById('resAppInput').value = formatNumber(hApp.toString());
                document.getElementById('rowBurd').classList.add('hidden');
                document.getElementById('buyerPriceLabel').innerText = 'Harga di App';
                document.getElementById('rowBuyerOng').style.display = 'flex';
            } else {
                hApp = mainVal;
                nomDisk = (hApp >= minO) ? Math.min(hApp * vDiskPct, mDisk) : 0;
                nomBurd = nomDisk * sBurdPct; 
                const sisa = hApp - nomBurd;
                nomKomisi = sisa * kPct; 
                nett = sisa - nomKomisi;
                
                document.getElementById('rowBurd').classList.remove('hidden');
                document.getElementById('buyerPriceLabel').innerText = 'Total Pesanan';
                document.getElementById('rowBuyerOng').style.display = 'none';
                
                const totalInv = nomKomisi + nomBurd;
                document.getElementById('totalInv').innerText = "Rp " + Math.round(totalInv).toLocaleString('id-ID').replace(/,/g, ".");
                document.getElementById('invPct').innerText = (mainVal > 0 ? ((totalInv / mainVal) * 100).toFixed(1) : 0) + "%";
            }

            const fmt = (v) => "Rp " + Math.round(v).toLocaleString('id-ID').replace(/,/g, ".");
            document.getElementById('resNet').innerText = fmt(nett);
            document.getElementById('resKomisi').innerText = "- " + fmt(nomKomisi);
            document.getElementById('resBurd').innerText = "- " + fmt(nomBurd);
            
            document.getElementById('bMenu').innerText = fmt(hApp);
            document.getElementById('bDisk').innerText = "- " + fmt(nomDisk);
            document.getElementById('bOng').innerText = fmt(vOng);
            document.getElementById('bTotal').innerText = fmt(Math.max(0, (hApp - nomDisk) + (currentMode === 'full' ? vOng : 0)));
            
            const promoStat = document.getElementById('promoStat');
            promoStat.innerText = nomDisk > 0 ? "Aktif" : (hApp < minO ? "Min Order Kurang" : "Non-Aktif");
            promoStat.style.backgroundColor = nomDisk > 0 ? "var(--grab-yellow)" : "#ff4d4d";
            promoStat.style.color = nomDisk > 0 ? "#000" : "#fff";
        }

        window.onload = () => switchCategory('full');
    </script>
</body>
</html>
