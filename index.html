<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Merchant Calculator | Grab Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --grab-green: #00B14F; --grab-yellow: #FFD200; --grab-dark: #004d22; }
        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #004d22 0%, #00B14F 50%, #008a3d 100%);
            color: white; 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            margin: 0; 
            overflow-y: auto;
        }

        header, section { flex-shrink: 0; }
        
        main { 
            flex-grow: 1; 
            padding: 0.5rem 0.75rem 3rem 0.75rem; 
            display: flex; 
            flex-direction: column; 
            gap: 0.5rem; 
        }

        .gradient-header { 
            background: #FFFFFF; 
            padding: 1rem 1.2rem; 
            border-bottom: 2px solid var(--grab-green); 
            position: sticky; 
            top: 0; 
            z-index: 50; 
            box-shadow: 0 2px 15px rgba(0,0,0,0.15);
        }

        .spotlight-dashboard { 
            background: white; 
            padding: 1.2rem 0.5rem; 
            border-bottom: 5px solid var(--grab-yellow); 
            color: #1a1a1a; 
            position: sticky; 
            top: 74px; 
            z-index: 40; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); 
        }

        /* SEPARATOR DASHBOARD DIPERTEGAS */
        .dash-separator { border-right: 2px solid #e2e8f0; }

        .dash-input { background: transparent; border: none; font-weight: 900; width: 100%; text-align: center; outline: none; padding: 0; margin: 0; font-style: italic; color: #1a1a1a; }
        
        .chips-panel { background: rgba(0, 0, 0, 0.2); padding: 0.6rem; border-radius: 18px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .chips-container { display: flex; gap: 0.3rem; justify-content: center; }
        .chip { flex: 1; padding: 0.5rem 0.1rem; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; font-size: 8px; font-weight: 900; text-transform: uppercase; border: 1.5px solid rgba(255,255,255,0.1); transition: 0.2s; text-align: center; }
        .chip.active { background: white; color: var(--grab-dark); border: 2px solid var(--grab-yellow); box-shadow: 0 0 12px rgba(255, 210, 0, 0.3); }

        .glass-panel { background: rgba(255, 255, 255, 0.96); backdrop-filter: blur(10px); border-radius: 16px; padding: 0.8rem; color: #1a1a1a; border: 1px solid rgba(255, 255, 255, 0.4); }
        
        /* LABEL KONTRAS TINGGI */
        .label-contrast { color: #475569; font-weight: 900; text-transform: uppercase; font-size: 8px; letter-spacing: 0.025em; }

        .vs-card { border: 2px solid transparent; border-radius: 14px; padding: 12px 8px; position: relative; transition: 0.4s; background: rgba(255,255,255,0.05); }
        .vs-card.winner { background: rgba(255, 210, 0, 0.15); border-color: var(--grab-yellow); box-shadow: 0 0 20px rgba(255, 210, 0, 0.3); }
        .winner-badge { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--grab-yellow); color: black; font-size: 8px; font-weight: 900; padding: 2px 10px; border-radius: 20px; border: 2px solid #000; display: none; z-index: 10; }
        .vs-card.winner .winner-badge { display: block; animation: bounce 0.5s infinite alternate; }

        .input-group { display: grid; grid-template-columns: 35px 1fr 35px; align-items: center; background: white; border: 2px solid #cbd5e1; border-radius: 10px; height: 44px; }
        .input-side { font-weight: 900; font-size: 11px; color: #64748b; display: flex; justify-content: center; align-items: center; }
        .input-pro { border: none; font-size: 1.2rem; font-weight: 900; width: 100%; text-align: center; outline: none; background: transparent; color: #0f172a; }
        .input-group.disabled { background: #f8fafc; opacity: 0.6; border-color: #e2e8f0; }

        #detailOverlay { position: fixed; top: 120px; left: 50%; transform: translateX(-50%) translateY(20px); width: 90%; max-width: 400px; background: rgba(0, 0, 0, 0.98); backdrop-filter: blur(20px); border-radius: 24px; padding: 25px; z-index: 100; opacity: 0; pointer-events: none; transition: 0.3s ease-out; border: 1px solid rgba(255,255,255,0.2); }
        #detailOverlay.active { opacity: 1; pointer-events: auto; transform: translateX(-50%) translateY(0); }

        .label-bold { font-size: 12px; font-weight: 900; text-transform: uppercase; color: #1e293b; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        @keyframes bounce { from { transform: translateX(-50%) translateY(0); } to { transform: translateX(-50%) translateY(-3px); } }
    </style>
</head>
<body onclick="closeOverlay()">

    <header class="gradient-header flex items-center gap-4">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR3eUHGPBllwPFxtkNKY7e_3T_mb2rKNWoMaRD6DON2dMI6swNt9a4Fee2k&s=10" alt="Grab" class="h-11 w-auto">
        <div class="flex flex-col">
            <p class="font-black text-[18px] tracking-tight uppercase text-slate-900 leading-none">MERCHANT <span class="text-[var(--grab-green)]">CALCULATOR</span></p>
            <p class="text-[11px] font-bold text-slate-500 italic mt-0.5">All in one calculation</p>
        </div>
    </header>

    <section class="spotlight-dashboard">
        <div class="max-w-5xl mx-auto grid grid-cols-3 gap-0 text-center items-center">
            <div class="dash-col dash-separator px-1">
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-tighter mb-1">App Price ‚úé</p>
                <div class="flex items-center justify-center text-2xl font-black italic text-slate-900">
                    <span class="text-sm mr-0.5">Rp</span>
                    <input type="text" id="resApp" class="dash-input text-2xl" value="0">
                </div>
                <div id="roundToggle" onclick="toggleRound(event)" class="text-[9px] font-black p-1 uppercase text-slate-400 cursor-pointer">Round ‚öôÔ∏è</div>
            </div>
            <div class="dash-col dash-separator px-1" onclick="showDetail(event, 'cust')">
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-tighter mb-1">Paid by Pax ‚ìò</p>
                <h2 id="resTP" class="text-2xl md:text-4xl font-black text-[var(--grab-green)] italic leading-none tracking-tight">Rp 0</h2>
                <div class="text-[8px] font-black text-slate-400 uppercase italic mt-1">Harga Bayar</div>
            </div>
            <div class="dash-col px-1" onclick="showDetail(event, 'net')">
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-tighter mb-1">Net Revenue ‚ìò</p>
                <h2 id="resNet" class="text-2xl md:text-4xl font-black text-emerald-600 italic leading-none tracking-tight">Rp 0</h2>
                <div class="text-[8px] font-black text-slate-400 uppercase italic mt-1">Mex Revenue</div>
            </div>
        </div>
    </section>

    <div id="detailOverlay" onclick="closeOverlay()">
        <div id="overlayContent"></div>
        <p class="text-[11px] text-center text-white/40 mt-6 uppercase font-black border-t border-white/10 pt-4">Tutup</p>
    </div>

    <main>
        <div class="glass-panel">
            <label class="label-bold italic">1. Harga Offline & Subsidi</label>
            <div class="grid grid-cols-2 gap-3 items-end">
                <div><span class="label-contrast">Offline Basis</span><div class="input-group"><div class="input-side">Rp</div><input type="text" id="mainVal" class="input-pro" placeholder="0"><div class="input-side"></div></div></div>
                <div>
                    <div class="flex justify-between"><span class="label-contrast">Subsidi</span><div class="flex gap-1"><button onclick="setSubMode('val')" id="sVal" class="inner-toggle active px-1 text-[10px] font-black text-slate-400">Rp</button><button onclick="setSubMode('pct')" id="sPct" class="inner-toggle px-1 text-[10px] font-black text-slate-400">%</button></div></div>
                    <div class="input-group border-blue-400"><div id="subPrefix" class="input-side text-blue-600">Rp</div><input type="text" id="subVal" class="input-pro text-blue-800" placeholder="0"><div class="input-side"></div></div>
                </div>
            </div>
        </div>

        <div class="chips-panel">
            <div class="chips-container">
                <button onclick="selectSchema('normal', event)" id="chip-normal" class="chip active">‚öñÔ∏è Normal</button>
                <button onclick="selectSchema('puas-cuan', event)" id="chip-puas-cuan" class="chip">üî• Cuan</button>
                <button onclick="selectSchema('booster', event)" id="chip-booster" class="chip">üöÄ Booster</button>
                <button onclick="selectSchema('cofund', event)" id="chip-cofund" class="chip">ü§ù Cofund</button>
            </div>
        </div>

        <div class="glass-panel">
            <div class="flex justify-between items-center mb-1">
                <div class="flex flex-col">
                    <label class="label-contrast !text-[var(--grab-green)]">BENEFIT STRATEGI</label>
                    <h1 id="schemeTitle" class="text-[1.1rem] font-black text-slate-900 uppercase leading-none tracking-tight">Normal Commision</h1>
                </div>
                <div id="tierSection" class="hidden">
                    <div class="flex bg-slate-200 p-0.5 rounded-lg border border-slate-300">
                        <button onclick="setTier('hemat')" id="btnHem" class="px-3 py-1 rounded-md text-[10px] font-black transition-all">HEMAT</button>
                        <button onclick="setTier('ekstra')" id="btnEks" class="px-3 py-1 rounded-md text-[10px] font-black transition-all ml-0.5">EKSTRA</button>
                    </div>
                </div>
            </div>
            <div id="benefitList" class="flex flex-wrap gap-1 border-t border-slate-200 pt-2"></div>
        </div>

        <div class="glass-panel">
            <label class="label-bold italic">3. Parameter Sistem</label>
            <div class="grid grid-cols-2 gap-x-3 gap-y-2">
                <div><span class="label-contrast">Merchant Comm %</span><div class="input-group"><div class="input-side"></div><input type="number" id="kPct" class="input-pro" value="20"><div class="input-side">%</div></div></div>
                <div><span class="label-contrast">Promo Disc %</span><div class="input-group"><div class="input-side"></div><input type="number" id="vDisk" class="input-pro text-red-600" value="0"><div class="input-side text-red-400">%</div></div></div>
                <div><span class="label-contrast">Max Disc Rp</span><div class="input-group"><div class="input-side">Rp</div><input type="text" id="mDisk" class="input-pro" value="0"><div class="input-side"></div></div></div>
                <div><span class="label-contrast !text-blue-600">Cofund Mex %</span><div id="cofundGroup" class="input-group border-blue-400 disabled"><div class="input-side"></div><input type="number" id="mShare" class="input-pro text-blue-700" value="0" disabled><div class="input-side">%</div></div></div>
                <div class="col-span-2 mt-1"><span class="label-contrast">Min Order Rp</span><div class="input-group"><div class="input-side">Rp</div><input type="text" id="minO" class="input-pro" value="0"><div class="input-side"></div></div></div>
            </div>
        </div>

        <div class="glass-panel !bg-black/60 !border-dashed !border-[var(--grab-yellow)] !p-3 mb-4 text-center">
            <div id="vsTitle" class="text-[12px] font-black text-[var(--grab-yellow)] uppercase mb-3 italic tracking-widest">NORMAL VS PROMO</div>
            <div class="grid grid-cols-2 gap-4">
                <div id="cardNormal" class="vs-card"><div class="winner-badge">WINNER üèÜ</div><p class="text-[10px] font-black opacity-60 text-white uppercase mb-2">NORMAL</p><div class="space-y-1 text-center"><span class="text-[8px] text-white/40 uppercase">App Price</span><p id="vsAppNormal" class="text-[13px] font-black text-white/60">Rp 0</p><span class="text-[9px] text-white/80 font-bold uppercase">Paid by Pax</span><p id="vsPayNormal" class="text-lg font-black text-white">Rp 0</p></div></div>
                <div id="cardPromo" class="vs-card"><div class="winner-badge">WINNER üèÜ</div><p id="vsPromoLabel" class="text-[10px] font-black text-[var(--grab-yellow)] uppercase mb-2">PROMO</p><div class="space-y-1 text-center"><span class="text-[8px] text-white/40 uppercase">App Price</span><p id="vsAppPromo" class="text-[13px] font-black text-white/60">Rp 0</p><span class="text-[9px] text-[var(--grab-yellow)] font-bold uppercase">Paid by Pax</span><p id="vsPayPromo" class="text-xl font-black text-[var(--grab-yellow)]">Rp 0</p></div></div>
            </div>
        </div>
    </main>

<script>
    let sTier = 'hemat', currentSchema = 'normal', isRounded = true, subMode = 'val';
    const calcData = { list: 0, disc: 0, pay: 0, net: 0, mexGB: 0, mPromoCost: 0 };
    const state = { mainVal: "25.000", kPct: 20, vDisk: 0, mDisk: "0", minO: "0", subVal: "0", mShare: 0 };

    const PRESETS = {
        'normal': { name: 'Normal Commision', k: 20, v: 0, b: ['Margin Aman 100%', 'Harga Menu Stabil'], s: 0 },
        'puas-cuan': { name: 'Diskon Puas Cuan', k: 32, v: 30, tiers: { hemat: { min: 15000, max: 45000 }, ekstra: { min: 35000, max: 80000 } }, b: ['Promo Grab Funded'], s: 0 },
        'booster': { name: 'Diskon Puas Booster', k: 38, v: 35, tiers: { hemat: { min: 15000, max: 55000 }, ekstra: { min: 35000, max: 100000 } }, b: ['Flash Sale 55%'], s: 0 },
        'cofund': { name: 'Skema Cofunding', k: 20, v: 40, b: ['Beban Patungan Diskon'], s: 75 }
    };

    const fNum = (n) => n.toString().replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    const pNum = (n) => parseFloat(n.toString().replace(/\./g, "")) || 0;

    function hitung(source = 'offline') {
        const commPct = pNum(state.kPct), subRaw = pNum(state.subVal), mSharePct = pNum(state.mShare), discPct = pNum(state.vDisk);
        const adj = subMode === 'val' ? subRaw : (pNum(state.mainVal) * subRaw / 100);

        if(source === 'app') {
            const appInput = pNum(document.getElementById('resApp').value);
            state.mainVal = fNum(Math.round((appInput * (1 - (commPct/100))) + adj));
            document.getElementById('mainVal').value = state.mainVal;
        }

        const off = pNum(state.mainVal);
        let listPromo = (off - adj) / (1 - (commPct/100));
        if (isRounded) listPromo = Math.ceil(listPromo/100)*100;
        
        const totalDisc = (listPromo >= pNum(state.minO)) ? Math.min(listPromo * discPct/100, pNum(state.mDisk) || Infinity) : 0;
        const paidPax = listPromo - totalDisc;

        if (currentSchema === 'cofund') {
            const mPromoCost = (mSharePct / 100) * (discPct / 100) * listPromo;
            const mexGB = (commPct / 100) * (listPromo - mPromoCost);
            calcData.net = listPromo - (mexGB + mPromoCost);
            calcData.mexGB = mexGB; calcData.mPromoCost = mPromoCost;
        } else {
            const grabComm = listPromo * (commPct / 100);
            calcData.net = listPromo - grabComm;
            calcData.mexGB = grabComm; calcData.mPromoCost = 0;
        }

        calcData.list = listPromo; calcData.disc = totalDisc; calcData.pay = paidPax;
        if(source !== 'app') document.getElementById('resApp').value = fNum(Math.round(listPromo));
        document.getElementById('resTP').innerText = "Rp " + fNum(Math.round(paidPax));
        document.getElementById('resNet').innerText = "Rp " + fNum(Math.round(calcData.net));

        let listNormal = (off - adj) / (1 - (20/100));
        if (isRounded) listNormal = Math.ceil(listNormal/100)*100;
        const isNormalWin = listNormal < paidPax;
        document.getElementById('vsAppNormal').innerText = "Rp " + fNum(Math.round(listNormal));
        document.getElementById('vsPayNormal').innerText = "Rp " + fNum(Math.round(listNormal));
        document.getElementById('vsAppPromo').innerText = "Rp " + fNum(Math.round(listPromo));
        document.getElementById('vsPayPromo').innerText = "Rp " + fNum(Math.round(paidPax));
        document.getElementById('vsTitle').innerText = `NORMAL VS ${currentSchema.toUpperCase()}`;
        document.getElementById('cardNormal').className = `vs-card ${isNormalWin ? 'winner' : ''}`;
        document.getElementById('cardPromo').className = `vs-card ${!isNormalWin ? 'winner' : ''}`;
    }

    function selectSchema(key, e) {
        if(e) e.stopPropagation();
        currentSchema = key;
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        document.getElementById(`chip-${key}`).classList.add('active');
        const conf = PRESETS[key];
        const ts = document.getElementById('tierSection'), cofundInput = document.getElementById('mShare'), cofundGroup = document.getElementById('cofundGroup');

        if (conf.tiers) {
            ts.classList.remove('hidden');
            document.getElementById('btnHem').className = `px-3 py-1 rounded-md text-[10px] font-black transition-all ${sTier === 'hemat' ? 'bg-slate-800 text-white' : 'bg-transparent text-slate-500'}`;
            document.getElementById('btnEks').className = `px-3 py-1 rounded-md text-[10px] font-black transition-all ml-0.5 ${sTier === 'ekstra' ? 'bg-slate-800 text-white' : 'bg-transparent text-slate-500'}`;
            state.kPct = conf.k; state.vDisk = conf.v; state.minO = fNum(conf.tiers[sTier].min); state.mDisk = fNum(conf.tiers[sTier].max);
        } else {
            ts.classList.add('hidden');
            state.kPct = conf.k; state.vDisk = conf.v; state.minO = "0"; state.mDisk = "0";
        }

        if (key === 'cofund') { cofundInput.disabled = false; cofundGroup.classList.remove('disabled'); state.mShare = conf.s; }
        else { cofundInput.disabled = true; cofundGroup.classList.add('disabled'); state.mShare = 0; }

        document.getElementById('schemeTitle').innerText = conf.name;
        renderBenefits(); updateUI();
    }

    function showDetail(e, type) {
        e.stopPropagation();
        const overlay = document.getElementById('detailOverlay'), content = document.getElementById('overlayContent');
        let html = '';
        if(type === 'cust') html = `<h3 class="text-[15px] font-black text-emerald-400 mb-4 uppercase text-center italic">Harga Bayar Detail</h3><div class="space-y-4 text-white text-[13px]"><div class="flex justify-between"><span>App Price</span><span>Rp ${fNum(Math.round(calcData.list))}</span></div><div class="flex justify-between text-red-400"><span>Total Diskon</span><span>- Rp ${fNum(Math.round(calcData.disc))}</span></div><div class="pt-4 border-t border-white/20 flex justify-between text-2xl font-black text-emerald-400"><span>PAID BY PAX</span><span>Rp ${fNum(Math.round(calcData.pay))}</span></div></div>`;
        else html = `<h3 class="text-[15px] font-black text-emerald-500 mb-4 uppercase text-center italic">Investment Detail</h3><div class="space-y-4 text-white text-[13px]"><div class="flex justify-between"><span>Initial App Price</span><span>Rp ${fNum(Math.round(calcData.list))}</span></div><div class="flex justify-between text-orange-400"><span>Mex GB (Komisi)</span><span>- Rp ${fNum(Math.round(calcData.mexGB))}</span></div><div class="flex justify-between text-blue-400"><span>Mex Promo Cost</span><span>- Rp ${fNum(Math.round(calcData.mPromoCost))}</span></div><div class="pt-4 border-t border-white/20 flex justify-between text-2xl font-black text-emerald-500"><span>NET REVENUE</span><span>Rp ${fNum(Math.round(calcData.net))}</span></div><div class="mt-4 pt-2 text-[11px] text-white/40 italic text-center">Net Revenue = App Price - (Mex GB + Mex Promo Cost)</div></div>`;
        content.innerHTML = html; overlay.classList.add('active');
    }

    function setTier(t) { sTier = t; selectSchema(currentSchema); }
    function renderBenefits() { const container = document.getElementById('benefitList'); container.innerHTML = ''; PRESETS[currentSchema].b.forEach(item => { container.innerHTML += `<div class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded border border-emerald-200 text-[10px] font-black italic">‚úì ${item}</div>`; }); }
    function updateUI() { document.getElementById('mainVal').value = state.mainVal; document.getElementById('kPct').value = state.kPct; document.getElementById('vDisk').value = state.vDisk; document.getElementById('mDisk').value = state.mDisk; document.getElementById('minO').value = state.minO; document.getElementById('subVal').value = state.subVal; document.getElementById('mShare').value = state.mShare; hitung(); }
    ['mainVal','kPct','vDisk','mDisk','minO','subVal','mShare'].forEach(id => { document.getElementById(id).addEventListener('input', (e) => { if(['mainVal','subVal','mDisk','minO'].includes(id)) e.target.value = fNum(e.target.value); state[id] = e.target.value; hitung('offline'); }); });
    document.getElementById('resApp').addEventListener('input', (e) => { e.target.value = fNum(e.target.value); hitung('app'); });
    function closeOverlay() { document.getElementById('detailOverlay').classList.remove('active'); }
    function toggleRound(e) { e.stopPropagation(); isRounded = !isRounded; hitung(); }
    function setSubMode(m) { subMode = m; document.getElementById('sVal').classList.toggle('active', m === 'val'); document.getElementById('sPct').classList.toggle('active', m === 'pct'); document.getElementById('subPrefix').innerText = m === 'val' ? 'Rp' : '%'; hitance(); }
    window.onload = () => selectSchema('normal');
</script>
</body>
</html>
