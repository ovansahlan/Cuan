<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MerchantCalculator Elite v6.8</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --grab-green: #00B14F; --grab-yellow: #FFD200; --pitch-black: #0F172A; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: linear-gradient(135deg, var(--grab-green) 0%, #008a3d 100%); min-height: 100vh; display: flex; justify-content: center; padding: 20px 0; margin: 0; }
        .main-wrapper { width: 92%; max-width: 980px; display: flex; flex-direction: column; gap: 15px; }
        .tab-box { background: rgba(0,0,0,0.2); padding: 4px; border-radius: 16px; position: relative; display: flex; border: 1.5px solid #000; }
        .tab-indicator { position: absolute; height: calc(100% - 8px); width: calc(33.33% - 4px); background: var(--grab-yellow); border-radius: 12px; transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55); border: 1.5px solid #000; z-index: 0; }
        .tab-btn { flex: 1; padding: 12px 0; font-size: 10px; font-weight: 800; text-transform: uppercase; z-index: 1; color: white; text-align: center; cursor: pointer; }
        .tab-btn.active { color: black !important; }
        .elite-card { background: #ffffff; border: 2px solid #000; box-shadow: 4px 4px 0px #000; border-radius: 28px; padding: 20px; }
        .dark-elite-card { background: var(--pitch-black); border: 2px solid #000; box-shadow: 4px 4px 0px rgba(0,0,0,0.5); border-radius: 28px; padding: 20px; }
        .input-group-elite { background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 16px; display: flex; flex-direction: column; justify-content: center; transition: all 0.2s; }
        input:focus { outline: none; }
        .label-pitch { font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; color: #64748b; }
        .comp-input-box { background: #ffffff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 8px; text-align: center; }
        .winner-active { border-color: var(--grab-green) !important; box-shadow: 0 0 20px rgba(0, 177, 79, 0.3), 6px 6px 0px var(--grab-green) !important; transform: scale(1.01); z-index: 10; }
        @media (min-width: 1024px) { .sticky-panel { position: sticky; top: 20px; } }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="header-container text-center mb-2">
        <h1 class="text-3xl font-black text-white italic uppercase tracking-tighter leading-none">Merchant <span class="text-[var(--grab-yellow)]">Calculator</span></h1>
    </div>

    <div class="tab-box">
        <div id="tabSlider" class="tab-indicator"></div>
        <button onclick="switchCategory('full')" id="btnFull" class="tab-btn active">Full Funded</button>
        <button onclick="switchCategory('co')" id="btnCo" class="tab-btn">Co-Funded</button>
        <button onclick="switchCategory('compare')" id="btnCompare" class="tab-btn">Compare</button>
    </div>

    <div id="mainView" class="grid grid-cols-1 lg:grid-cols-2 gap-6 items-start">
        <div class="space-y-4">
            <div class="elite-card space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <div class="input-group-elite p-4">
                        <label class="label-pitch text-center">Offline Price</label>
                        <div class="flex items-center justify-center font-black">
                            <span class="text-xs opacity-30 mr-1 italic">Rp</span>
                            <input type="text" id="mainVal" class="bg-transparent w-full text-center text-xl outline-none" oninput="handleInput(this, 'mainVal')">
                        </div>
                    </div>
                    <div class="input-group-elite p-4">
                        <label class="label-pitch text-center italic text-green-600">Commission %</label>
                        <div class="flex items-center justify-center font-black">
                            <input type="number" id="kPct" class="bg-transparent w-full text-center text-xl outline-none text-green-600" oninput="updateVal('kPct', this.value)">
                            <span class="text-xs text-green-600 ml-1">%</span>
                        </div>
                    </div>
                </div>

                <div class="input-group-elite p-4 border-blue-200 bg-blue-50/30">
                    <div class="flex justify-between items-center mb-1">
                        <label class="label-pitch text-blue-600 italic">Price Pressing Subsidy</label>
                        <select id="subType" class="text-[8px] font-black bg-white border border-blue-200 px-1 rounded outline-none" onchange="hitung()">
                            <option value="val">IDR (Rp)</option>
                            <option value="pct">Percent (%)</option>
                        </select>
                    </div>
                    <div class="flex items-center justify-between font-black text-blue-600">
                        <span id="subLabel" class="text-xs">Rp</span>
                        <input type="text" id="subVal" value="0" class="bg-transparent w-full text-right text-xl outline-none" oninput="handleInput(this, 'subVal')">
                    </div>
                </div>

                <div class="p-5 bg-slate-50 rounded-[24px] border-[1.2px] border-slate-200 space-y-4">
                    <div class="flex justify-between items-center px-1"><label class="label-pitch text-slate-400 uppercase font-black">Presets</label><button onclick="savePreset()" class="text-[8px] font-black bg-black text-white px-3 py-1 rounded">SAVE</button></div>
                    <select id="schemaSelect" class="w-full text-xs font-black bg-white border-[1.2px] border-black p-3 rounded-xl outline-none shadow-sm" onchange="applySchema(this.value)"></select>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-white p-3 rounded-xl border border-slate-200 text-center"><span class="text-[8px] font-black text-slate-400 block uppercase">Disc %</span><input type="number" id="vDisk" class="w-full text-lg font-black text-red-500 text-center outline-none" oninput="updateVal('vDisk', this.value)"></div>
                        <div class="bg-white p-3 rounded-xl border border-slate-200 text-center"><span class="text-[8px] font-black text-slate-400 block uppercase">Max Disc</span><input type="text" id="mDisk" class="w-full text-lg font-black text-red-500 text-center outline-none" oninput="handleInput(this, 'mDisk')"></div>
                    </div>
                    <div class="flex justify-between items-center px-4 py-2 bg-white rounded-xl border border-slate-200"><span class="text-[9px] font-bold text-slate-400 uppercase">Min Order</span><input type="text" id="minO" class="bg-transparent text-right font-black text-sm w-32 outline-none text-slate-600" oninput="handleInput(this, 'minO')"></div>
                </div>
            </div>
        </div>

        <div class="space-y-4 sticky-panel">
            <div id="captureOutput" class="space-y-4 p-1"> <div class="bg-[#0F172A] border-2 border-black p-6 rounded-[32px] text-center relative shadow-xl">
                    <label class="absolute top-4 right-5 flex items-center cursor-pointer select-none"><span class="text-[7px] font-black mr-1 text-white opacity-40">ROUND UP</span><input type="checkbox" id="roundCheck" checked onchange="hitung()" class="w-3.5 h-3.5 accent-yellow-400"></label>
                    <label class="text-[10px] font-black text-yellow-400 uppercase tracking-widest block mb-1">App Listing Price</label>
                    <div class="flex items-center justify-center text-white italic leading-none"><span class="text-2xl mr-1 opacity-50 font-black">Rp</span><input type="text" id="resApp" value="0" class="bg-transparent w-full text-6xl font-black outline-none text-center" readonly></div>
                </div>
                <div class="dark-elite-card !bg-[#0F172A] p-6 rounded-[32px] border-2 border-black">
                    <div class="flex justify-between items-end">
                        <div><p class="text-[10px] font-black text-yellow-400 uppercase tracking-widest">Net Profit</p><h2 id="resNet" class="text-5xl font-black text-yellow-400 italic leading-none">Rp 0</h2></div>
                        <div class="text-right text-slate-500"><p class="text-[8px] font-bold uppercase">Comm. Fee</p><p id="resKomisi" class="text-base font-black text-white italic">Rp 0</p></div>
                    </div>
                </div>
                <div id="cardBuyer" class="elite-card border-b-[12px] border-yellow-400">
                    <div class="flex justify-between items-center mb-3 border-b border-slate-100 pb-2 text-[10px] font-black text-slate-400 uppercase italic"><span>Customer Bill</span><span id="promoStat" class="px-3 py-1 rounded-full text-white uppercase italic text-[8px]"></span></div>
                    <div class="space-y-1.5 text-sm font-bold uppercase text-[10px]">
                        <div class="flex justify-between text-slate-500"><span>Price in App</span><span id="bMenu" class="text-black font-black">Rp 0</span></div>
                        <div class="flex justify-between text-red-500"><span>Discount</span><span id="bDisk" class="font-black">- Rp 0</span></div>
                        <div class="pt-3 mt-2 border-t-2 border-dashed border-slate-200 flex justify-between items-center"><span class="text-black text-[12px]">Total Payment</span><span id="bTotal" class="text-4xl font-black text-[#00B14F] tracking-tighter">Rp 0</span></div>
                    </div>
                </div>
            </div>
            
            <button onclick="takeSnapshot()" class="w-full bg-black text-white py-4 rounded-2xl border-2 border-white/20 font-black uppercase text-xs tracking-widest flex items-center justify-center gap-2 hover:bg-zinc-900 active:scale-95 transition-all">
                <span>ðŸ“¸ Capture & Share to WhatsApp</span>
            </button>
        </div>
    </div>

    <div id="compareView" class="hidden space-y-4">
        <div class="elite-card text-center italic text-slate-400 py-10 uppercase font-black">Compare Mode Active</div>
    </div>
</div>

<script>
    let currentMode = 'full';
    const state = {
        full: { mainVal: "25.000", kPct: 32, vDisk: 30, mDisk: "55.000", minO: "15.000", vOng: "0", subVal: "0", schema: "puas-cuan" },
        co: { mainVal: "60.000", kPct: 20, vDisk: 55, mDisk: "50.000", minO: "60.000", vOng: "0", subVal: "0", sBurden: 75, schema: "brand-week" }
    };

    const DEFAULT_SCHEMAS = {
        full: { 
            'normal': { name: 'âš–ï¸ NORMAL PRICE', k: 20, v: 0, m: 0, min: 0, burden: 0 },
            'puas-cuan': { name: 'ðŸ”¥ DISKON PUAS CUAN', k: 32, v: 30, m: 55000, min: 15000 },
            'booster-hemat': { name: 'ðŸš€ BOOSTER HEMAT', k: 38, v: 35, m: 55000, min: 15000 }
        },
        co: { 
            'normal': { name: 'âš–ï¸ NORMAL PRICE', k: 20, v: 0, m: 0, min: 0, burden: 0 },
            'brand-week': { name: 'ðŸŽŠ BRAND WEEK FESTIVAL', k: 20, v: 55, m: 50000, min: 60000, burden: 75 }
        }
    };

    const fNum = (n) => n.toString().replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    const pNum = (n) => parseFloat(n.toString().replace(/\./g, "")) || 0;

    // FUNGSI INPUT BARU (Mencegah Error Kalkulasi)
    function handleInput(el, field) {
        el.value = fNum(el.value);
        state[currentMode][field] = el.value;
        hitung();
    }

    function updateVal(field, val) {
        state[currentMode][field] = val;
        hitung();
    }

    function switchCategory(mode) {
        currentMode = (mode === 'compare') ? currentMode : mode;
        const slider = document.getElementById('tabSlider');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        
        if(mode === 'compare') {
            slider.style.transform = 'translateX(200%)';
            document.getElementById('btnCompare').classList.add('active');
            document.getElementById('mainView').classList.add('hidden');
            document.getElementById('compareView').classList.remove('hidden');
        } else {
            slider.style.transform = (mode === 'full') ? 'translateX(0)' : 'translateX(100%)';
            document.getElementById('btn' + mode.charAt(0).toUpperCase() + mode.slice(1)).classList.add('active');
            document.getElementById('mainView').classList.remove('hidden');
            document.getElementById('compareView').classList.add('hidden');
            
            const s = state[mode];
            document.getElementById('mainVal').value = s.mainVal;
            document.getElementById('kPct').value = s.kPct;
            document.getElementById('vDisk').value = s.vDisk;
            document.getElementById('mDisk').value = s.mDisk;
            document.getElementById('minO').value = s.minO;
            document.getElementById('subVal').value = s.subVal;
            renderSchemaDropdown();
        }
    }

    function renderSchemaDropdown() {
        const select = document.getElementById('schemaSelect');
        select.innerHTML = '';
        for (let key in DEFAULT_SCHEMAS[currentMode]) {
            let opt = document.createElement('option');
            opt.value = key; opt.innerText = DEFAULT_SCHEMAS[currentMode][key].name;
            select.appendChild(opt);
        }
        select.value = state[currentMode].schema;
        hitung();
    }

    function applySchema(key) {
        state[currentMode].schema = key;
        const config = DEFAULT_SCHEMAS[currentMode][key];
        if(config) {
            document.getElementById('kPct').value = config.k;
            document.getElementById('vDisk').value = config.v;
            document.getElementById('mDisk').value = fNum(config.m);
            document.getElementById('minO').value = fNum(config.min);
            state[currentMode].kPct = config.k;
            state[currentMode].vDisk = config.v;
            state[currentMode].mDisk = fNum(config.m);
            state[currentMode].minO = fNum(config.min);
            hitung();
        }
    }

    function hitung() {
        const s = state[currentMode];
        const offline = pNum(s.mainVal);
        const kPct = pNum(s.kPct)/100;
        const subType = document.getElementById('subType').value;
        const subVal = pNum(s.subVal);
        const isRound = document.getElementById('roundCheck').checked;

        document.getElementById('subLabel').innerText = subType === 'val' ? 'Rp' : '%';
        const nominalSubsidi = subType === 'val' ? subVal : (offline * (subVal / 100));
        const pressingBasis = offline - nominalSubsidi;
        
        let listing = currentMode === 'full' ? (pressingBasis / (1 - kPct)) : pressingBasis;
        if(currentMode === 'full' && isRound && listing > 0) listing = Math.ceil(listing/100)*100;
        
        const komisi = listing * kPct;
        const finalDiskon = (listing >= pNum(s.minO)) ? Math.min(listing * (pNum(s.vDisk)/100), pNum(s.mDisk)) : 0;
        const netProfit = listing - komisi - (currentMode === 'co' ? (finalDiskon * (pNum(s.sBurden)/100)) : 0);
        
        document.getElementById('resApp').value = fNum(Math.round(listing));
        document.getElementById('resNet').innerText = "Rp " + fNum(Math.round(netProfit));
        document.getElementById('resKomisi').innerText = "Rp " + fNum(Math.round(komisi));
        document.getElementById('bMenu').innerText = "Rp " + fNum(Math.round(listing));
        document.getElementById('bDisk').innerText = "- Rp " + fNum(Math.round(finalDiskon));
        document.getElementById('bTotal').innerText = "Rp " + fNum(Math.round(listing - finalDiskon));
        
        const pStat = document.getElementById('promoStat');
        const isActive = listing >= pNum(s.minO);
        pStat.innerText = isActive ? "PROMO ACTIVE" : "MIN ORDER NOT MET";
        pStat.style.background = isActive ? "var(--grab-green)" : "#ef4444";
    }

    // FUNGSI CAPTURE & SHARE
    async function takeSnapshot() {
        const area = document.getElementById('captureOutput');
        const btn = event.currentTarget;
        btn.innerText = "ðŸ“¸ Capturing...";
        
        try {
            const canvas = await html2canvas(area, {
                backgroundColor: "#00B14F",
                scale: 2,
                borderRadius: 32
            });
            
            const imgData = canvas.toDataURL("image/png");
            const link = document.createElement('a');
            link.download = `CuanCalc_${Date.now()}.png`;
            link.href = imgData;
            link.click();

            const text = encodeURIComponent(
                `*--- MERCHANT CALCULATOR ELITE ---*\n\n` +
                `ðŸ“Š *Schema:* ${currentMode.toUpperCase()}\n` +
                `ðŸ’° *Offline:* Rp ${state[currentMode].mainVal}\n` +
                `ðŸ“± *Harga Aplikasi:* Rp ${document.getElementById('resApp').value}\n` +
                `---------------------------------\n` +
                `ðŸ’¸ *PROFIT BERSIH:* ${document.getElementById('resNet').innerText}\n` +
                `ðŸ›ï¸ *Bayar Konsumen:* ${document.getElementById('bTotal').innerText}\n\n` +
                `_(Gunakan gambar yang baru saja terdownload)_`
            );

            setTimeout(() => {
                window.open(`https://wa.me/?text=${text}`, '_blank');
            }, 1000);
            
        } catch (e) {
            alert("Error: Gagal memotret layar.");
        } finally {
            btn.innerText = "ðŸ“¸ Capture & Share to WhatsApp";
        }
    }

    function savePreset() {
        alert("Preset Saved to Memory");
    }

    window.onload = () => switchCategory('full');
</script>
</body>
</html>
